<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.6"/>
<title>LDMud: codestyle</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">LDMud
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.6 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('driver_internals_codestyle.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">codestyle </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>The LPMud gamedriver is by nature the result of the cooperative work of multiple programmers, often separated by large oceans and years of time. In order to keep the appearance of the driver source consistent (and with that maintainable), the following guidelines should be followed for all code contributions.</p>
<p>For a quick start in how good driver source should look like, take a look at comm.{c,h}, object.{c,h} and mapping.{c.h}.</p>
<p>The guidelines have a strong emphasis on code layout and commenting, stemming from the fact that proper layout and comments gave the incentive for LDMud in the first place. Right now, 50% of all lines are comments, and that has been proven to be a Good Thing.</p>
<p>Any reader of the "real programmers don't write comments"-school of thought is asked to take his or her incompetence elsewhere.</p>
<h2>Language</h2>
<p>The language is ISO Standard C (also known as 'C89' or 'ANSI C'). Common compiler extensions or features from the new C99 standard are permitted if their addition is transparent for other C89 compilers. For example: the 'inline' keyword permitted through the use of the INLINE macro; so are the Metrowerks-pragmas and GNU-attributes. Not permitted are GNU's local functions.</p>
<p>System/Platform specifics are to be detected by the configure script and provided with transparent implementations in port.{c,h} (or for module-specific dependencies in the respective modules).</p>
<p>Adherence to the Standard has the following implications:</p>
<ul>
<li>All functions must be fully prototyped.</li>
<li>Standard types like size_t, ssize_t or ptrdiff_t are to be used wherever possible.</li>
<li>Unixisms like:~~~{.c} { a = malloc(20); b = malloc(20); c = b-a; }</li>
</ul>
<div class="fragment"><div class="line">- Don<span class="stringliteral">&#39;t make assumptions about the size of the base types (e.g. a char might have more than 8 bits). If such an assumption is unavoidable, comment it clearly and if possible add a test to raise a compile or runtime error if the assumption is not met.</span></div>
<div class="line"><span class="stringliteral"></span></div>
<div class="line"><span class="stringliteral">## Style #</span></div>
<div class="line"><span class="stringliteral"></span></div>
<div class="line"><span class="stringliteral">All modules (.c-files) have to have their interface in an accompanying .h-file. The header file must be guarded against repeated inclusion with the normal:</span></div>
<div class="line"><span class="stringliteral"></span></div>
<div class="line"><span class="stringliteral">~~~{.c}</span></div>
<div class="line"><span class="stringliteral">#ifndef HEADERNAME_H</span></div>
<div class="line"><span class="stringliteral">#define HEADERNAME_H 1</span></div>
<div class="line"><span class="stringliteral">  ...</span></div>
<div class="line"><span class="stringliteral">#endif /* HEADERNAME_H </span></div>
</div><!-- fragment --><p> construct. To use a module, its headerfile must be included - no random 'extern' declarations.</p>
<p>Every module must include "driver.h" which in turn includes the portability headers and provides common defines.</p>
<p>Use the driver-provided types and macros like Bool or p_int.</p>
<p>Code should be written defensively and readable. This is not the IOCCC.</p>
<p>No magic numbers - use #defines to give them names.</p>
<p>Add sanity checks where useful. If the checks are costly, enclose them in a #ifdef DEBUG...#endif bracket.</p>
<p>Comment questionable code or opportunities for possible extensions with a 'TODO: ...' comment. For multiline comments, use 'TODO::' on the second and following lines (this makes reading a grep easier).</p>
<p>Comment temporary debug code with a 'DEBUG:' comment. Similar, debug output should always begin with 'DEBUG:'.</p>
<p>Variable identifiers should start with a lowercase letter, function identifiers may start with upper or lowercase, constant identifiers should start with an uppercase letter. Macro identifiers should be all UPPERCASE, other identifiers may be under_scored or SkudlyCaps. Hungarian notation is accepted only in a very light form: pFoo for pointers, ppFoo for pointer to pointers, iFoo for integer types, sFoo for string pointers, aFoo for complex types - you get the idea. But no alpzsFoo and friends.</p>
<p>f_xxx() function names are reserved for efun implementations. typedef'd typenames should end in _t (e.g. 'mapping_t'), struct names should end in _s (e.g. 'struct instrs_s').</p>
<p>Indentation is 4 spaces per level. No tab characters anywhere!</p>
<p>The indentation style is a variant of the 'Allman style':</p>
<div class="fragment"><div class="line"><span class="keywordflow">if</span> (foo)</div>
<div class="line">{</div>
<div class="line">    ...body...</div>
<div class="line">} <span class="comment">/* if (foo) </span></div>
</div><!-- fragment --><p> Note the comment at the closing brace!</p>
<p>One line bodies may be written as:</p>
<div class="fragment"><div class="line"><span class="keywordflow">if</span> (foo) body;</div>
</div><!-- fragment --><p> or:</p>
<div class="fragment"><div class="line"><span class="keywordflow">if</span> (foo)</div>
<div class="line">    body;</div>
</div><!-- fragment --><p> <em>if</em> it improves the readability.</p>
<p>Similar, the typical layout of a function is:</p>
<div class="fragment"><div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span></div>
<div class="line">function_name ( arg1 , arg2)</div>
<div class="line"></div>
<div class="line"><span class="comment">/* Twiddle &lt;arg1&gt; with &lt;arg2&gt; and return the result.</span></div>
<div class="line"><span class="comment"></span></div>
<div class="line"><span class="comment"></span></div>
<div class="line"><span class="comment">{</span></div>
<div class="line"><span class="comment">    ....</span></div>
<div class="line"><span class="comment">} /* function_name() </span></div>
</div><!-- fragment --><p> If an expression (argument list, ...) extends over several, the first literal element on a line should be an operator or syntactical marker:</p>
<div class="fragment"><div class="line"><span class="keywordflow">if</span> (condition1</div>
<div class="line"> &amp;&amp; (   condition2</div>
<div class="line">     || condition3)</div>
<div class="line">   )</div>
<div class="line"></div>
<div class="line">printf( <span class="stringliteral">&quot;...&quot;</span></div>
<div class="line">      , arg1, arg2, arg3</div>
<div class="line">      );</div>
</div><!-- fragment --><p> Be generous with whitespace - both horizontal and vertical.</p>
<p>[ The reasoning behind this style is to use the language elements to create strong visual structures for the eyes to follow. By doing so, the structure of the program becomes obvious without much conscious thought. ]</p>
<h2>Commenting</h2>
<p>The comments also follow the idea of giving strong visual clues of how the program is structured.</p>
<p>Horizontal lines should be created as:</p>
<div class="fragment"><div class="line"><span class="comment">/*------...-------</span></div>
<div class="line"><span class="comment">/*======...=======</span></div>
<div class="line"><span class="comment">/* - - -... - - - </span></div>
</div><!-- fragment --><p> The <code>---</code> line is the normal separator between the components of a source file (includes, variable declarations, macro declarations, the separate functions). The <code>===</code> line can be used to separate larger sections of a source file (e.g. the lowlevel routines from the efun implementations). <code>- -</code> lines, which usally span less than the whole line, can be used to subdivide large functions (though then it's often better to split the function into several small ones).</p>
<p>A <code>***</code> line is reserved for the end of every source file.</p>
<p>A <code>/* --- Subsection ---</code> is also good to separate subsections.</p>
<p>Vertical lines are to be constructed as:</p>
<div class="fragment"><div class="line"><span class="comment">/*</span></div>
<div class="line"><span class="comment"> *</span></div>
</div><!-- fragment --><p> No box comments.</p>
<p>Every function must have a head comment explaining the meaning of the arguments, what the function does, and the possible results. For efun implementations, this comment should be identical to the man page.</p>
<p>Within a function, every variable should be commented as:</p>
<div class="fragment"><div class="line"><span class="keywordtype">int</span> foo;  <span class="comment">/* short comment </span></div>
<div class="line"><span class="comment">int bar;</span></div>
<div class="line"><span class="comment">  /* long comment which doesn&#39;t fit on one line.</span></div>
</div><!-- fragment --><p> The major steps in a function should be preceeded by a comment explaining them. Also, wherever a critical design decision has been made, a comment should line out the whats and whys:</p>
<div class="fragment"><div class="line"><span class="comment">/* Duplicate the stored arguments for the function call.</span></div>
<div class="line"><span class="comment"> * (It&#39;s tempting to use the stored arguments directly</span></div>
<div class="line"><span class="comment"> *  in the last pass; however it&#39;s not guaranteed that</span></div>
<div class="line"><span class="comment"> *  the last pass actually comes this far.)</span></div>
</div><!-- fragment --><p> A typical file layout, commentwise, looks like this:</p>
<div class="fragment"><div class="line"><span class="comment">/*------------------------------------------------------</span></div>
<div class="line"><span class="comment"> * Gamedriver Bouncing module.</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> * &lt;reserved for future copyright notice&gt;</span></div>
<div class="line"><span class="comment"> *------------------------------------------------------</span></div>
<div class="line"><span class="comment"> * &#39;Big picture&#39; description of the module and its</span></div>
<div class="line"><span class="comment"> * relation to the other gamedriver parts.</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> * Tricky design discussions also belong in here.</span></div>
<div class="line"><span class="comment"> *------------------------------------------------------</span></div>
<div class="line"><span class="comment"></span></div>
<div class="line"><span class="comment"></span></div>
<div class="line"><span class="comment">#include &quot;driver.h&quot;</span></div>
<div class="line"><span class="comment">#include &quot;typedefs.h&quot;</span></div>
<div class="line"><span class="comment"></span></div>
<div class="line"><span class="comment">#include &lt;stdlib.h&gt;</span></div>
<div class="line"><span class="comment"></span></div>
<div class="line"><span class="comment">#include &quot;bounce.h&quot;</span></div>
<div class="line"><span class="comment">#include &quot;backend.h&quot;</span></div>
<div class="line"><span class="comment"></span></div>
<div class="line"><span class="comment">/*--------------------------------------------------------</span></div>
<div class="line"><span class="comment"></span></div>
<div class="line"><span class="comment">/* --- User information --- </span></div>
<div class="line"><span class="comment">interactive_t *all_bouncers[MAX_PLAYERS];</span></div>
<div class="line"><span class="comment"></span></div>
<div class="line"><span class="comment">/* ---  Statistics --- </span></div>
<div class="line"><span class="comment"></span></div>
<div class="line"><span class="comment">p_int number_of_calls;</span></div>
<div class="line"><span class="comment"></span></div>
<div class="line"><span class="comment">/*--------------------------------------------------------</span></div>
<div class="line"><span class="comment">void</span></div>
<div class="line"><span class="comment">add_bouncer (interactive_t *bouncer)</span></div>
<div class="line"><span class="comment"></span></div>
<div class="line"><span class="comment">/* This function adds &lt;bouncer&gt; to the all_bouncers[].</span></div>
<div class="line"><span class="comment"></span></div>
<div class="line"><span class="comment">{</span></div>
<div class="line"><span class="comment">    int i;  /* search index </span></div>
<div class="line"><span class="comment"></span></div>
<div class="line"><span class="comment">    ....</span></div>
<div class="line"><span class="comment">} /* add_bouncer() </span></div>
<div class="line"><span class="comment"></span></div>
<div class="line"><span class="comment">/*</span></div>
</div><!-- fragment --> </div></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="driver_internals_overview.html">Driver-internal docs</a></li>
    <li class="footer">Generated on Thu Mar 9 2017 17:45:24 for LDMud by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.6 </li>
  </ul>
</div>
</body>
</html>
