<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.6"/>
<title>LDMud: closure_guide</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">LDMud
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.6 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('driver_syntax_closure_guide.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">closure_guide </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>Guide to closures #</p>
<p>A closure is a pointer to a function. That means that it is data like an int or a string are. It may be assigned to a variable or given to anoth- er function as argument.</p>
<h1>Overview and efun-closures</h1>
<p>To create a closure that points to an efun (like <a class="el" href="classefun.html#afacd7cdaff7309a4b579f4c14db53662" title="Write out something to the current user. ">efun::write()</a>) you can write the name of the efun prepended with "hash-tick": <code>#'</code>. <code>#'write</code> is a closure that points to <a class="el" href="classefun.html#afacd7cdaff7309a4b579f4c14db53662" title="Write out something to the current user. ">efun::write()</a>.</p>
<dl class="section user"><dt>tip: If your editor gets confused by the hashmark, try putting parentheses around such a closure-notation because otherwise my : (#'write). This is especially of interest within lambda-closures (see below).</dt><dd></dd></dl>
<p>A closure can be evaluated (which means that the function it points to is called) using <a class="el" href="classefun.html#a665f686219e1bffdb5e89a5158167473" title="Evaluates the closure. ">efun::funcall()</a> or <a class="el" href="classefun.html#aaf018e933ee843dfe67f2916aeeb51a1" title="Evaluates the closure cl with the following arguments. ">efun::apply()</a>, which also allow to give arguments to the function. Example:</p>
<div class="fragment"><div class="line">funcall(#<span class="stringliteral">&#39;write,&quot;hello&quot;);</span></div>
</div><!-- fragment --><p> This will result in the same as <code>write("hello");</code> alone. The string "hello" is given as first (and only) argument to the function the closure <code>#'write</code> points to.</p>
<p>The return value of the function the closure points to is returned by <a class="el" href="classefun.html#a665f686219e1bffdb5e89a5158167473" title="Evaluates the closure. ">efun::funcall()</a> or <a class="el" href="classefun.html#aaf018e933ee843dfe67f2916aeeb51a1" title="Evaluates the closure cl with the following arguments. ">efun::apply()</a>. (Since <a class="el" href="classefun.html#afacd7cdaff7309a4b579f4c14db53662" title="Write out something to the current user. ">efun::write()</a> always returns 0 the return value of the example above will be 0.)</p>
<p>What are closures good for? With closures you can make much more universally usable functions. A good example is the function <a class="el" href="classefun.html#ac5e7282ed029a438608ee96f18052e33" title="Call the function &lt;ob&gt;-&gt;&lt;func&gt;() resp. ">efun::filter()</a>. It gets an array and a closure as arguments. Then it calls the function the closure points to for each element of the array:</p>
<div class="fragment"><div class="line">filter(({ <span class="stringliteral">&quot;bla&quot;</span>,<span class="stringliteral">&quot;foo&quot;</span>,<span class="stringliteral">&quot;bar&quot;</span> }),#<span class="stringliteral">&#39;write);</span></div>
</div><!-- fragment --><p> This will call <code>write("bla")</code>, <code>write("foo")</code> and <code>write("bar")</code> in any order; the order is undefined. (In the current implementation the given closure is evaluated for all elements from the first to the last, so the output will be "blafoobar".)</p>
<p>Furthermore <a class="el" href="classefun.html#ac5e7282ed029a438608ee96f18052e33" title="Call the function &lt;ob&gt;-&gt;&lt;func&gt;() resp. ">efun::filter()</a> examines the return value of each call of the function the closure points to (the return value of <a class="el" href="classefun.html#afacd7cdaff7309a4b579f4c14db53662" title="Write out something to the current user. ">efun::write()</a>). If the value is true (not 0) then this element is put into another array which <a class="el" href="classefun.html#ac5e7282ed029a438608ee96f18052e33" title="Call the function &lt;ob&gt;-&gt;&lt;func&gt;() resp. ">efun::filter()</a> builds up. If the return value is false (== 0) then this element is <em>not</em> put into this array. When all calls are done the slowly built up array is returned. Thus, <a class="el" href="classefun.html#ac5e7282ed029a438608ee96f18052e33" title="Call the function &lt;ob&gt;-&gt;&lt;func&gt;() resp. ">efun::filter()</a> filters from the given array all elements that the given closure evaluates "true" for and returns an array of those. (The array given to <a class="el" href="classefun.html#ac5e7282ed029a438608ee96f18052e33" title="Call the function &lt;ob&gt;-&gt;&lt;func&gt;() resp. ">efun::filter()</a> itself is <em>not</em> changed!)</p>
<p>A more sensical example for filter would be this:</p>
<div class="fragment"><div class="line">x = filter(users(),#<span class="stringliteral">&#39;query_is_wizard);</span></div>
</div><!-- fragment --><p> <a class="el" href="classefun.html#a46c12392d13bc3a5c91c20a6f7de7c7c" title="Return an array containing all interactive users. ">efun::users()</a> is an efun that gets no arguments and returns an array of all logged in players (wizards and players). <code>query_is_wizard</code> is a simul_efun that gets an object as first (and only) argument and returns true (1) if this object is a wizard and 0 otherwise.</p>
<p>So, for each element of the array returned by <a class="el" href="classefun.html#a46c12392d13bc3a5c91c20a6f7de7c7c" title="Return an array containing all interactive users. ">efun::users()</a> the function <code>query_is_wizard</code> is called and only those for which 1 was returned are collected into the result and then put into the variable x.</p>
<p>We now have all logged in wizards stored as array in the variable x.</p>
<p>Another example: We want to filter out all numbers that are greater than 42 from the array a of integers:</p>
<div class="fragment"><div class="line">x = filter(({ 10,50,30,70 }),#<span class="stringliteral">&#39;&gt;,42); // x is now ({ 50,70 })</span></div>
</div><!-- fragment --><p> Here two things are new: first: we create a closure that points to an operator; second: we use the possibility to give extra arguments to <a class="el" href="classefun.html#ac5e7282ed029a438608ee96f18052e33" title="Call the function &lt;ob&gt;-&gt;&lt;func&gt;() resp. ">efun::filter()</a>.</p>
<p>Like all efuns the usual operators can be pointed to with a closure by prepending <code>#'</code> to them. `funcall(#'&gt;,4,5)<code>is exactly the same as</code>(4&gt;5)`.</p>
<p>The extra arguments given as third to last argument (as many as you like) to <a class="el" href="classefun.html#ac5e7282ed029a438608ee96f18052e33" title="Call the function &lt;ob&gt;-&gt;&lt;func&gt;() resp. ">efun::filter()</a> are given as second to last argument to the function pointed to by the closure each time it is called.</p>
<p>Thus we now call <code>(({ 10,50,30,70 })[0]&gt;42)</code>, <code>(({ 10,50,30,70 })[1]&gt;42)</code> ... (which is <code>(</code><code>10&gt;42)</code>, <code>(50&gt;42)</code> ...) and return an array of all elements this returns true for and store it into x.</p>
<p>If you want to create a closure to an efun of which you have the name stored in a string you can create such an efun-closure with <a class="el" href="classefun.html#a6f70cb143146d31cee7c413d2f0a0b9a" title="Constructs a lfun closure, efun closure, or operator closure from the first arg (string or symbol)...">efun::symbol_function()</a>:</p>
<div class="fragment"><div class="line">symbol_function(<span class="stringliteral">&quot;write&quot;</span>) <span class="comment">// this will return #&#39;write</span></div>
<div class="line"></div>
<div class="line">funcall(symbol_function(&quot;write&quot;),&quot;foobar&quot;);  <span class="comment">// == write(&quot;foobar&quot;);</span></div>
</div><!-- fragment --><p> This function does not very often occur in normal code but it is very useful for tool-programming (eg the robe uses <a class="el" href="classefun.html#a6f70cb143146d31cee7c413d2f0a0b9a" title="Constructs a lfun closure, efun closure, or operator closure from the first arg (string or symbol)...">efun::symbol_function()</a> to allow you call any efun you give).</p>
<h1>Lfun- and Lambda-Closures</h1>
<p>Very often the possibilities closures to efuns offer are not sufficient for the purpose one has. In nearly all cases three possibilities exist in such cases: use an lfun- or inline-closure, or a lambda-closure.</p>
<h2>Lfun-Closures</h2>
<p>The first possibility is rather easy: like with the efun-closures you can create a pointer to a function in the same object you are by using the <code>#'</code> to prepend it to a function name of a function declared above. Example:</p>
<div class="fragment"><div class="line">status foo(<span class="keywordtype">int</span> x) {</div>
<div class="line">  <span class="keywordflow">return</span> ((x*2) &gt; 42);</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">int</span> *bar() {</div>
<div class="line">  <span class="keywordflow">return</span> filter(({ 10,50,30,70 }),#<span class="stringliteral">&#39;foo);</span></div>
<div class="line"><span class="stringliteral">}</span></div>
</div><!-- fragment --><p> Thus, <code>#'foo</code> is used like there was an efun of this name and doing the job that is done in <code>foo()</code>.</p>
<h2>Inline Closures</h2>
<p>Inline closures are a variant of lfun closures, the difference being that the function text is written right where the closure is used, enclosed in a pair of <code>(:</code> and <code>:)</code>. The compiler will then take care of creating a proper lfun and lfun-closure. The arguments passed to such an inline closure are accessible by position: <code>$1</code> would be the first argument, <code>$2</code> the second, and so on. With this, the above example would read:</p>
<div class="fragment"><div class="line"><span class="keywordtype">int</span> * bar() {</div>
<div class="line">  <span class="keywordflow">return</span> filter(({ 10,50,30,70 }), (: ($1 * 2) &gt; 42 :));</div>
<div class="line">}</div>
</div><!-- fragment --><p> or alternatively:</p>
<div class="fragment"><div class="line"><span class="keywordtype">int</span> * bar() {</div>
<div class="line">  <span class="keywordflow">return</span> filter(({ 10,50,30,70 }), (: <span class="keywordflow">return</span> ($1 * 2) &gt; 42; :));</div>
<div class="line">}</div>
</div><!-- fragment --><p> The difference between the two versions is that in the first form the text of the inline closure must be an expression only, whereas in the second form any legal statement is allowed. The compiler distinguishes the two forms by the last character before the <code>:)</code>: if it's a <code>;</code> or <code>}</code>, the compiler treats the closure as statement(s), otherwise as expression.</p>
<p>Inline closures may also nested, so that the following (not very useful) example is legal, too:</p>
<div class="fragment"><div class="line"><span class="keywordflow">return</span> filter(</div>
<div class="line">  ({ 10, 50, 30, 70 }),</div>
<div class="line">  (: <span class="keywordtype">string</span> *s;</div>
<div class="line">    s = map(users(), (: $1-&gt;query_name() :));</div>
<div class="line">    <span class="keywordflow">return</span> s[random(<span class="keyword">sizeof</span>(s))] + ($1 * 2);</div>
<div class="line">  :)</div>
<div class="line">);</div>
</div><!-- fragment --><p> The notation of inline closures is modelled after the MudOS functionals, but there are a few important differences in behaviour.</p>
<h2>Lambda-Closures</h2>
<p>Lambda-Closures take the idea of 'define it where you use it' one step further. On first glance they may look like inline closures with an uglier notation, but they offer a few increased possibilities. But first things first.</p>
<p>The efun <a class="el" href="classefun.html#a4ef2926c525dcf7e7d339d3f424b18a9" title="Constructs a lambda closure, like lambda function in LISP. ">efun::lambda()</a> creates a function temporarily and returns a closure pointing to this function. <a class="el" href="classefun.html#a4ef2926c525dcf7e7d339d3f424b18a9" title="Constructs a lambda closure, like lambda function in LISP. ">efun::lambda()</a> therefor gets two arrays as arguments, the first is a list of all arguments the function shall expect and the second array is the code of the function (in a more or less complicated form; at least not in C- or LPC-syntax). The closure <code>#'foo</code> from the example above could be notated as lambda-closure:</p>
<div class="fragment"><div class="line">lambda(</div>
<div class="line">  ({ <span class="stringliteral">&#39;x }),</span></div>
<div class="line"><span class="stringliteral">  ({</span></div>
<div class="line"><span class="stringliteral">    (#&#39;</span>&gt;),</div>
<div class="line">    ({ (#<span class="stringliteral">&#39;*),&#39;</span>x,2 }),</div>
<div class="line">    42</div>
<div class="line">  })</div>
<div class="line">)</div>
</div><!-- fragment --><p> Now, the first argument is <code>({ 'x })</code>, an array of all arguments the function shall expect: 1 argument (called 'x) is expected. Notice the strange notation for this argument with one single leading tick. Like The hash-tick to denote closures the leading tick is used to denote things called "symbols". They do not differ much from strings and if you do not want to have a deeper look into closures you can leave it this way.</p>
<p>The second argument is an array. The first element of such an array must be an efun- or an lfun-closure, the further elements are the arguments for the function this closure points to. If such an argument is an array, it is treated alike; the first element must be a closure and the remaining elements are arguments (which of course also might be arrays ...).</p>
<p>This leads to a problem: sometimes you want to give an array as an argument to a function. But arrays in an array given to <a class="el" href="classefun.html#a4ef2926c525dcf7e7d339d3f424b18a9" title="Constructs a lambda closure, like lambda function in LISP. ">efun::lambda()</a> are interpreted as code-arrays. To allow you to give an array as an argument within an array given to <a class="el" href="classefun.html#a4ef2926c525dcf7e7d339d3f424b18a9" title="Constructs a lambda closure, like lambda function in LISP. ">efun::lambda()</a>, you can use the function <a class="el" href="classefun.html#a78e86c560d9bfc454fc228b3988db651" title="Converts arrays to quoted arrays and strings to symbols. ">efun::quote()</a> to make your array to a quoted array (a quoted array is for an array what a symbol is for a string):</p>
<div class="fragment"><div class="line">lambda(0,</div>
<div class="line">  ({</div>
<div class="line">    (#<span class="stringliteral">&#39;sizeof),</span></div>
<div class="line"><span class="stringliteral">    quote(({ 10,50,30,70 }))</span></div>
<div class="line"><span class="stringliteral">  })</span></div>
<div class="line"><span class="stringliteral">)</span></div>
</div><!-- fragment --><p> For array constants, you can also use a single quote to the same effect:</p>
<div class="fragment"><div class="line">lambda(0,</div>
<div class="line">  ({</div>
<div class="line">    (#<span class="stringliteral">&#39;sizeof),</span></div>
<div class="line"><span class="stringliteral">    &#39;</span>({ 10,50,30,70 })</div>
<div class="line">  })</div>
<div class="line">)</div>
</div><!-- fragment --><p> This lambda-closure points to a function that will return 4 (it will call <a class="el" href="classefun.html#a1b26f2ff266e671649fc060bea19b228" title="Returns the number of elements of an array or struct, the number of characters in a string...">efun::sizeof()</a> for the array <code>({ 10,50,30,70 })</code>). Another thing: if we want to create a function that expects no arguments, we can give an empty array as first argument to <a class="el" href="classefun.html#a4ef2926c525dcf7e7d339d3f424b18a9" title="Constructs a lambda closure, like lambda function in LISP. ">efun::lambda()</a> but we can give 0 as well to attain this. This is just an abbreviation.</p>
<p>Lambda-closure constructs can become quite large and hard to read. The larger they become the harder the code is to read and you should avoid extreme cases. Very often the possibility to use an lfun or an inline instead of a large lambda shortens the code dramatically. Example:</p>
<div class="fragment"><div class="line">status foo(<span class="keywordtype">object</span> o) {</div>
<div class="line">  <span class="keywordflow">return</span> environment(o)-&gt;query_level()&gt;WL_APPRENTICE;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line">x=filter(a,#<span class="stringliteral">&#39;foo);</span></div>
</div><!-- fragment --><p> does the same as:</p>
<div class="fragment"><div class="line">x=filter(</div>
<div class="line">  a,</div>
<div class="line">  lambda(</div>
<div class="line">    ({ <span class="stringliteral">&#39;o }),</span></div>
<div class="line"><span class="stringliteral">    ({</span></div>
<div class="line"><span class="stringliteral">      (#&#39;</span>&gt;),</div>
<div class="line">      ({</div>
<div class="line">        (#<span class="stringliteral">&#39;call_other),</span></div>
<div class="line"><span class="stringliteral">        ({ (#&#39;</span>environment),<span class="stringliteral">&#39;o }),</span></div>
<div class="line"><span class="stringliteral">        &quot;query_level&quot;</span></div>
<div class="line"><span class="stringliteral">      }),</span></div>
<div class="line"><span class="stringliteral">      WL_APPRENTICE</span></div>
<div class="line"><span class="stringliteral">    })</span></div>
<div class="line"><span class="stringliteral">  )</span></div>
<div class="line"><span class="stringliteral">);</span></div>
</div><!-- fragment --> <dl class="section user"><dt>note: the syntax with the arrow -&gt; for efun::call_other() cannot be used, `#'-&gt;does not exist. You have to use#'call_other` for this and give the name of the lfun to be called as a string.)</dt><dd></dd></dl>
<p>This example also demonstrates the two disadvantages of lambda closures. First, they are very difficult to read, even for a simple example like this. Second, the lambda closure is re-created everytime the <a class="el" href="classefun.html#ac5e7282ed029a438608ee96f18052e33" title="Call the function &lt;ob&gt;-&gt;&lt;func&gt;() resp. ">efun::filter()</a> is executed, even though the created code is always the same.</p>
<p>'Why use lambdas at all then?' you may ask now. Well, read on.</p>
<h3>Advantages of Lambda Closures</h3>
<p>The advantages of lambdas stem from the fact that they are created at runtime from normal arrays.</p>
<p>This means that the behaviour of a lambda can be made dependant on data available only at runtime. For example:</p>
<div class="fragment"><div class="line">closure c;</div>
<div class="line">c = lambda(0, ({#<span class="stringliteral">&#39;-, ({ #&#39;</span>time }), time() }) );</div>
</div><!-- fragment --><p> Whenever you now call this closure (<code>funcall(c)</code>) it will return the elapsed time since the closure was created.</p>
<p>The second advantage of lambdas is that the arrays from which they are compiled can be constructed at runtime. Imagine a customizable prompt which can be configured to display the time, the environment, or both:</p>
<div class="fragment"><div class="line">mixed code;</div>
<div class="line"></div>
<div class="line">code = ({ <span class="stringliteral">&quot;&gt; &quot;</span> });</div>
<div class="line"><span class="keywordflow">if</span> (user_wants_time)</div>
<div class="line">{</div>
<div class="line">  code = ({ #<span class="stringliteral">&#39;+, ({ #&#39;</span>ctime }), code });</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keywordflow">if</span> (user_wants_environment)</div>
<div class="line">{</div>
<div class="line">  code = ({</div>
<div class="line"><span class="preprocessor">    #&#39;+,</span></div>
<div class="line"><span class="preprocessor"></span>    ({</div>
<div class="line"><span class="preprocessor">      #&#39;to_string,</span></div>
<div class="line"><span class="preprocessor"></span>      ({#<span class="stringliteral">&#39;environment, ({#&#39;</span>this_player }) })</div>
<div class="line">    }),</div>
<div class="line">    code</div>
<div class="line">  });</div>
<div class="line">}</div>
<div class="line">set_prompt(lambda(0, code));</div>
</div><!-- fragment --><h3>Free Variables in Lambda-Closure Constructs</h3>
<p>You can use local variables in lambda constructs without declaring them, just use them. The only limitation is that you at first have to assign something to them. Give them as symbols like you do with the arguments. This feature does not make much sense without the use of complexer flow controlling features described below.</p>
<p>The closure `#'=` is used to assign a value to something (like <a class="el" href="driver_syntax_operators.html">=</a>).</p>
<h3>Special Efun-Closures and Operator-Closures for Lambdas</h3>
<p>There are some special closures that are supposed to be used only within a lambda construct. With them you can create nearly all code you can with regular LPC-code like loops and conditions.</p>
<p>`#'?` acts like the "if" statement in LPC. The first argument is the condition, the second is the code to be executed if the condition returns true. The following arguments can also be such couples of code-arrays that state a condition and a possible result. If at the end there is a single argument, it is used as the else-case if no condition returned true:</p>
<div class="fragment"><div class="line">lambda(</div>
<div class="line">  ({ <span class="stringliteral">&#39;x }),</span></div>
<div class="line"><span class="stringliteral">  ({</span></div>
<div class="line"><span class="stringliteral">    (#&#39;</span>?),             <span class="comment">// if</span></div>
<div class="line">    ({ (#<span class="stringliteral">&#39;&gt;),&#39;</span>x,5 }),  <span class="comment">//    (x &gt; 5)</span></div>
<div class="line">    ({ (#<span class="stringliteral">&#39;*),&#39;</span>x,2 }),  <span class="comment">//       result is x * 2;</span></div>
<div class="line">    ({ (#<span class="stringliteral">&#39;&lt;),&#39;</span>x,-5 }), <span class="comment">// else if (x &lt; -5)</span></div>
<div class="line">    ({ (#<span class="stringliteral">&#39;/),&#39;</span>x,2 }),  <span class="comment">//    result is x/2;</span></div>
<div class="line">    <span class="stringliteral">&#39;x                 // else result is x;</span></div>
<div class="line"><span class="stringliteral">  })</span></div>
<div class="line"><span class="stringliteral">)</span></div>
</div><!-- fragment --><p>`#'?!<code> is like the</code>#'?` but it negates all conditions after evaluation and thus is like an ifnot in LPC (if there were one).</p>
<p>`#',` (which looks a bit strange) is the equivalent of the comma-operator in LPC and says: evaluate all arguments and return the value of the last. It is used to do several things inside a lambda-closure:</p>
<div class="fragment"><div class="line">lambda(</div>
<div class="line">  ({ <span class="stringliteral">&#39;x }),</span></div>
<div class="line"><span class="stringliteral">  ({</span></div>
<div class="line"><span class="stringliteral">    (#&#39;</span>,),  <span class="comment">// two commas necessary! one for the closure and one as delimiter in the array</span></div>
<div class="line">    ({ (#<span class="stringliteral">&#39;write),&quot;hello world!&quot; }),</span></div>
<div class="line"><span class="stringliteral">    ({ (#&#39;</span>say),<span class="stringliteral">&quot;Foobar.&quot;</span> })</div>
<div class="line">  })</div>
<div class="line">)</div>
</div><!-- fragment --><p><code>#'while</code> acts like the LPC statement "while" and repeats executing one code-array while another returns true. <code>#'while</code> expects two or more arguments: the condition as first argument, then the result the whole expression shall have after the condition turns false (this is in many cases of no interest) and as third to last argument the body of the loop:</p>
<div class="fragment"><div class="line">lambda(</div>
<div class="line">  0,</div>
<div class="line">  ({</div>
<div class="line">    (#<span class="stringliteral">&#39;,),                 // several things to do ...</span></div>
<div class="line"><span class="stringliteral">    ({ (#&#39;</span>=),<span class="stringliteral">&#39;i,0 }),      // i is a local variable of this lambda-closure and is initialized with 0 now.</span></div>
<div class="line"><span class="stringliteral">    ({</span></div>
<div class="line"><span class="stringliteral">      (#&#39;</span><span class="keywordflow">while</span>),</div>
<div class="line">      ({ (#<span class="stringliteral">&#39;&lt;),&#39;</span>i,10 }),   <span class="comment">// condition: i &lt; 10</span></div>
<div class="line">      42,                  <span class="comment">// result is not interesting, but we must give one</span></div>
<div class="line">      ({ (#<span class="stringliteral">&#39;write),&#39;</span>i }),  <span class="comment">// give out i</span></div>
<div class="line">      ({ (#<span class="stringliteral">&#39;+=),&#39;</span>i,1 })    <span class="comment">// increase i</span></div>
<div class="line">    })</div>
<div class="line">  })</div>
<div class="line">)</div>
</div><!-- fragment --><p> The function this closure points to will give out the numbers from 0 to 9 and then return 42.</p>
<p><code>#'do</code> is like the do-while statement in LPC and is very much like the <code>#'while</code>. The difference is that <code>#'while</code> tests the condition already before the body is evaluated for the first time, this means that the body might not be evaluated even once. <code>#'do</code> evaluates the body first and then the condition, thus the body is evaluated at least one time.</p>
<p>Furthermore, the arguments for <code>#'do</code> are changed in order. <code>#'do</code> expects as first to last but two the body of the loop, then the condition (as last-but-one'th argument) and the result value as last argument. So <code>#'do</code> must have at least two arguments: the condition and the result:</p>
<div class="fragment"><div class="line">lambda(</div>
<div class="line">  0,</div>
<div class="line">  ({</div>
<div class="line">    (#<span class="stringliteral">&#39;,),                 // several things to do ...</span></div>
<div class="line"><span class="stringliteral">    ({ (#&#39;</span>=),<span class="stringliteral">&#39;i,0 }),      // i is a local variable of this lambda-closure and is initialized with 0 now.</span></div>
<div class="line"><span class="stringliteral">    ({</span></div>
<div class="line"><span class="stringliteral">      (#&#39;</span><span class="keywordflow">do</span>),</div>
<div class="line">      ({ (#<span class="stringliteral">&#39;write),&#39;</span>i }),  <span class="comment">// give out i</span></div>
<div class="line">      ({ (#<span class="stringliteral">&#39;+=),&#39;</span>i,1 }),   <span class="comment">// increase i</span></div>
<div class="line">      ({ (#<span class="stringliteral">&#39;&lt;),&#39;</span>i,10 }),   <span class="comment">// condition: i &lt; 10</span></div>
<div class="line">      42                   <span class="comment">// result is not interesting</span></div>
<div class="line">    })</div>
<div class="line">  })</div>
<div class="line">)</div>
</div><!-- fragment --> <dl class="section user"><dt>note: There is no #'for in LPC, you should use #'while for this.</dt><dd></dd></dl>
<p><code>#'foreach</code> is like the <a class="el" href="driver_syntax_foreach.html">foreach</a> statement in LPC. It evaluates one or more bodies repeatedly for every value in a giving string, array or mapping. The result of the closure is 0.</p>
<p><code>#'foreach</code> expects two or more arguments:</p>
<ul>
<li>a single variable symbol, or an array with several variable symbols</li>
<li>the value to iterate over</li>
<li>zero or more bodes to evaluate in each iteration.</li>
</ul>
<p>The single values retrieved from the given value are assigned one after another to the variable(s), then the bodies are executed for each assignment:</p>
<div class="fragment"><div class="line">lambda(</div>
<div class="line">  0,</div>
<div class="line">  ({</div>
<div class="line"><span class="preprocessor">    #&#39;foreach,</span></div>
<div class="line"><span class="preprocessor"></span>    <span class="stringliteral">&#39;o,</span></div>
<div class="line"><span class="stringliteral">    ({#&#39;</span>users}),</div>
<div class="line">    ({#<span class="stringliteral">&#39;call_other, &#39;</span>o, <span class="stringliteral">&quot;die&quot;</span> })</div>
<div class="line">  })</div>
<div class="line">);</div>
<div class="line"></div>
<div class="line">lambda(</div>
<div class="line">  0,</div>
<div class="line">  ({</div>
<div class="line"><span class="preprocessor">    #&#39;foreach,</span></div>
<div class="line"><span class="preprocessor"></span>    ({<span class="stringliteral">&#39;k, &#39;</span>v}),</div>
<div class="line">    ({ ...mapping...}),</div>
<div class="line">    ({#<span class="stringliteral">&#39;printf, &quot;%O:%O\n&quot;, &#39;</span>k, <span class="stringliteral">&#39;v })</span></div>
<div class="line"><span class="stringliteral">  })</span></div>
<div class="line"><span class="stringliteral">);</span></div>
</div><!-- fragment --><p><code>#'return</code> gets one argument and acts like the "return" statement in LPC in the function that is created by <a class="el" href="classefun.html#a4ef2926c525dcf7e7d339d3f424b18a9" title="Constructs a lambda closure, like lambda function in LISP. ">efun::lambda()</a>. It aborts the execution of this function and returns the argument:</p>
<div class="fragment"><div class="line">lambda(</div>
<div class="line">  0,</div>
<div class="line">  ({</div>
<div class="line">    (#<span class="stringliteral">&#39;while),// loop</span></div>
<div class="line"><span class="stringliteral">    1,        // condition is 1 ==&gt; endles loop</span></div>
<div class="line"><span class="stringliteral">    42,       // return value (which will never be used)</span></div>
<div class="line"><span class="stringliteral">    ({ (#&#39;</span>write), <span class="stringliteral">&quot;grin&quot;</span> }),</div>
<div class="line">    ({</div>
<div class="line">      (#<span class="stringliteral">&#39;?!),                // ifnot</span></div>
<div class="line"><span class="stringliteral">      ({ (#&#39;</span>random), 10 }),  <span class="comment">//       (random(10))</span></div>
<div class="line">      ({ (#<span class="stringliteral">&#39;return), 100 })  //   return 100;</span></div>
<div class="line"><span class="stringliteral">    })</span></div>
<div class="line"><span class="stringliteral">  })</span></div>
<div class="line"><span class="stringliteral">)</span></div>
</div><!-- fragment --><p> This function will enter an endless loop that will in each turn give out "grin" and if <code>random(10)</code> returns 0 (which will of course happen very soon) it will leave the function with "return 100". The value 42 that is given as result of the loop would be returned if the condition would evaluate to 0 which cannot be. (1 is never 0 ;-)</p>
<p><code>#'break</code> is used like the "break" statement in LPC and aborts the execution of loops and switches. It must not appear outside a loop or switch of the lambda closure itself, it cannot abort the execution of the function the closure points to!:</p>
<div class="fragment"><div class="line">lambda(</div>
<div class="line">  0,</div>
<div class="line">  ({</div>
<div class="line">    (#<span class="stringliteral">&#39;?),</span></div>
<div class="line"><span class="stringliteral">    ({ (#&#39;</span>random),2 }),</div>
<div class="line">    ({ (#<span class="stringliteral">&#39;break) }), // this will cause the error &quot;Unimplemented operator break for lambda()&quot;</span></div>
<div class="line"><span class="stringliteral">    &quot;random was false!&quot;</span></div>
<div class="line"><span class="stringliteral">  })</span></div>
<div class="line"><span class="stringliteral">);</span></div>
</div><!-- fragment --><p> You can use <code>({ #'return,0 })</code> instead of <code>({ #'break })</code> in such cases.</p>
<p><code>#'continue</code> is used like the "continue" statement in LPC and jumps to the end of the current loop and continues with the loop condition.</p>
<p><code>#'default</code> may be used within a <code>#'switch-construct</code> but be careful! To call <code>symbol_function("default")</code> (which is done usually by tools that allow closure-creation) might crash the driver! So please do only use it within your LPC-files.</p>
<dl class="section user"><dt>note: This driver bug is fixed somewhere below  driver_mailto:3.2.1@131 "3.2.1@131".</dt><dd></dd></dl>
<p>`#'..<code> may be used within a</code>#'switch-construct<code>but is not implemented yet (@subpage driver_mailto:3.2.1@131 "3.2.1\@131"). But</code>#'[..]` works well instead of it.</p>
<p><code>#'switch</code> is used to create closures which behave very much like the switch-construct in LPC. To understand the following you should already know the syntax and possibilities of the latter one (which is mightier than the C-version of switch).</p>
<p>I will confront some LPC versions and the corresponding closure versions below.</p>
<div class="fragment"><div class="line">LPC:                  Closure::</div>
<div class="line"></div>
<div class="line">switch (x) {                    lambda(0,({ (#<span class="stringliteral">&#39;switch), x,</span></div>
<div class="line"><span class="stringliteral">case 5:                           ({ 5 }),</span></div>
<div class="line"><span class="stringliteral"> return &quot;five&quot;;                  ({ (#&#39;</span><span class="keywordflow">return</span>),<span class="stringliteral">&quot;five&quot;</span> }),</div>
<div class="line">                                 (#<span class="stringliteral">&#39;,),</span></div>
<div class="line"><span class="stringliteral">case 6..9:                        ({ 6, (#&#39;</span>[..]), 9 }),</div>
<div class="line"> <span class="keywordflow">return</span> <span class="stringliteral">&quot;six to nine&quot;</span>;           ({ (#<span class="stringliteral">&#39;return),</span></div>
<div class="line"><span class="stringliteral">                                    &quot;six to nine&quot; }),</span></div>
<div class="line"><span class="stringliteral">                                 (#&#39;</span>,),</div>
<div class="line"><span class="keywordflow">case</span> 1:                           ({ 1 }),</div>
<div class="line"> write(<span class="stringliteral">&quot;one&quot;</span>);                   ({ (#<span class="stringliteral">&#39;write),&quot;one&quot; }),</span></div>
<div class="line"><span class="stringliteral"> // fall through                 (#&#39;</span>,),</div>
<div class="line"><span class="keywordflow">case</span> 2:                           ({ 2,</div>
<div class="line"><span class="keywordflow">case</span> 10:                             10 }),</div>
<div class="line"> <span class="keywordflow">return</span> <span class="stringliteral">&quot;two or ten&quot;</span>;            ({ (#<span class="stringliteral">&#39;return),</span></div>
<div class="line"><span class="stringliteral">                                    &quot;two or ten&quot; }),</span></div>
<div class="line"><span class="stringliteral">                                 (#&#39;</span>,),</div>
<div class="line"><span class="keywordflow">case</span> 3..4:                        ({ 3, (#<span class="stringliteral">&#39;[..]), 4 }),</span></div>
<div class="line"><span class="stringliteral"> write(&quot;three to four&quot;);         ({ (#&#39;</span>write),</div>
<div class="line">                                    <span class="stringliteral">&quot;three to four&quot;</span> }),</div>
<div class="line"> <span class="keywordflow">break</span>;  <span class="comment">// leave switch         (#&#39;break),</span></div>
<div class="line"><span class="keywordflow">default</span>:                          ({ (#<span class="stringliteral">&#39;default) }),</span></div>
<div class="line"><span class="stringliteral"> write(&quot;something else&quot;);        ({ (#&#39;</span>write),</div>
<div class="line">                                    <span class="stringliteral">&quot;something else&quot;</span> }),</div>
<div class="line"> <span class="keywordflow">break</span>;                          (#<span class="stringliteral">&#39;break)</span></div>
<div class="line"><span class="stringliteral">}                              }))</span></div>
</div><!-- fragment --><p>`#'&amp;&amp;` evaluates the arguments from the first on and stops if one evaluates to 0 and returns 0. If none evaluates to 0 it returns the result of the last argument.</p>
<p>`#'||` evaluates the arguments from the first on and stops if one evaluates to true (not 0) and returns it. If all evaluate to 0 it returns 0.</p>
<p><code>#'catch</code> executes the closure given as argument, but catches any runtime error (see <a class="el" href="classefun.html#ae5c7019db4983c1c09bbf9ebe1b93869" title="Evaluate the expressions. ">efun::catch()</a>). Optionally the symbols 'nolog, 'publish and 'reserve may be given as additional arguments to modify the behaviour of the catch.</p>
<p><code>#'sscanf</code> acts similar to how a funcall would, but passes the third and following arguments as lvalues, that is, values which can be assigned to.</p>
<p>`#'=<code>and the</code>#'&lt;op&gt;=` variants are also special because the first argument has to be an lvalue.</p>
<h2>Closures with Strange Names</h2>
<p><code>#'negate</code> is the unary minus that returns -x for the argument x.:</p>
<div class="fragment"><div class="line">map(({ 1,2,3 }), #<span class="stringliteral">&#39;negate) // returns ({ -1,-2,-3 })</span></div>
</div><!-- fragment --><p>`#'[` is used for the things that in LPC are done with the [] (it indexes an array or a mapping):</p>
<div class="fragment"><div class="line">lambda(0, ({ #<span class="stringliteral">&#39;[, quote(({ 10, 50, 30, 70 })), 2 })) ==&gt; 30</span></div>
<div class="line"><span class="stringliteral">lambda(0, ({ #&#39;</span>[, ([ <span class="stringliteral">&quot;x&quot;</span>:10;50, <span class="stringliteral">&quot;y&quot;</span>:30;70 ]), <span class="stringliteral">&quot;x&quot;</span>, 1 })) ==&gt; 50</div>
</div><!-- fragment --><p>`#'[&lt;<code> is the same as</code>#'[<code>but counts the elements from the end (like indexing with</code>[]<code>and the</code>&lt;`).</p>
<p>`#'[..]` returns a subarray of the argument from the one given index to the other given index, both counted from the beginning of the array.</p>
<p>`#'[..&lt;]<code> </code>#'[&lt;..]<code> </code>#'[&lt;..&lt;]` same as above, but the indexes are counted from the end:</p>
<div class="fragment"><div class="line">lambda(</div>
<div class="line">  0,</div>
<div class="line">  ({</div>
<div class="line"><span class="preprocessor">    #&#39;[..&lt;],</span></div>
<div class="line"><span class="preprocessor"></span>    quote(({ 0,1,2,3,4,5,6,7 })),</div>
<div class="line">    2,</div>
<div class="line">    3</div>
<div class="line">  })</div>
<div class="line">)</div>
</div><!-- fragment --><p> This will return <code>({ 2,3,4,5 })</code>.</p>
<p>`#'[..<code> </code>#'[&lt;..<code> same as above, but only the first index is given, the subarray will go till the end of the original (like with</code>[x..]`).</p>
<p>`#'({<code> is used to create arrays (as with</code>({ })` in LPC). All arguments become the elements of the array.:</p>
<div class="fragment"><div class="line">lambda(</div>
<div class="line">  0,</div>
<div class="line">  ({</div>
<div class="line"><span class="preprocessor">    #&#39;({,</span></div>
<div class="line"><span class="preprocessor"></span>    ({ (#<span class="stringliteral">&#39;random), 10 }),</span></div>
<div class="line"><span class="stringliteral">    ({ (#&#39;</span>random), 50 }),</div>
<div class="line">    ({ (#<span class="stringliteral">&#39;random), 30 }),</span></div>
<div class="line"><span class="stringliteral">    ({ (#&#39;</span>random), 70 })</div>
<div class="line">  })</div>
<div class="line">)</div>
</div><!-- fragment --><p> This returns <code>({ random(10), random(50), random(30), random(70) })</code>.</p>
<p>`#'([<code> is used to create mappings out of single entries (with several values) like the</code>([ ])` in LPC. Very unusual is the fact that this closure gets arrays as argument that are not evaluated, although they are not quoted.:</p>
<div class="fragment"><div class="line">lambda(</div>
<div class="line">  0,</div>
<div class="line">  ({</div>
<div class="line"><span class="preprocessor">    #&#39;([,</span></div>
<div class="line"><span class="preprocessor"></span>    ({ <span class="stringliteral">&quot;x&quot;</span>,1,2,3 }),</div>
<div class="line">    ({ <span class="stringliteral">&quot;y&quot;</span>,4,5,6 })</div>
<div class="line">  })</div>
<div class="line">);</div>
</div><!-- fragment --><p> This returns <code>([ "x": 1;2;3, "y": 4;5;6 ])</code>.</p>
<p>However, the elements of the arrays are evaluated as lambda expressions, so if you want to create a mapping from values evaluated at call time, write them as lambda closures:</p>
<div class="fragment"><div class="line">lambda(0, ({ #<span class="stringliteral">&#39;([, ({ 1, ({ #&#39;</span>ctime }) }) }) )</div>
</div><!-- fragment --><p> will return <code>([ 1: &lt;result of ctime() at call time&gt; ])</code>.</p>
<p>Arrays can be put into the mapping by quoting:</p>
<div class="fragment"><div class="line">lambda(0, ({ #<span class="stringliteral">&#39;([, ({ 1, &#39;</span>({ 2 }) }) }) )</div>
</div><!-- fragment --><p> will return <code>([ 1: ({ 2 }) ])</code></p>
<p>`#'[,]<code> is nearly the same as</code>#'[`. The only difference shows up if you want to index a mapping with a width greater than 1 (with more than just one value per key) directly with <a class="el" href="classefun.html#a665f686219e1bffdb5e89a5158167473" title="Evaluates the closure. ">efun::funcall()</a>. Example:</p>
<div class="fragment"><div class="line">funcall(#<span class="stringliteral">&#39;[,([ 0:1;2, 3:4;5 ]),0,1)</span></div>
</div><!-- fragment --><p> This will not work. Use `#'[,]<code>and it will work. If you want to use it in a lambda closure you do not have to use</code>#'[,]<code>and</code>#'[<code>will do fine. On the other hand,</code>#'[,]<code>cannot work with arrays, so in nearly all cases use</code>#'[<code>and just in the described special case, use</code>#'[,]`. This is a strange thing and I deem it a bug, so it might change in the future.</p>
<h2>Operator-Closures</h2>
<p>Most of the closures that are used for things which are done by operators are in fact not operator-closures but efun-closures. But there are a few which do not have the state of efun-closures but are called "operator-closures". <code>#'return</code> is an example, a complete list of them is given below.</p>
<p>These closures cannot be called directly using <a class="el" href="classefun.html#a665f686219e1bffdb5e89a5158167473" title="Evaluates the closure. ">efun::funcall()</a> or <a class="el" href="classefun.html#aaf018e933ee843dfe67f2916aeeb51a1" title="Evaluates the closure cl with the following arguments. ">efun::apply()</a> (or other efuns like <a class="el" href="classefun.html#ac5e7282ed029a438608ee96f18052e33" title="Call the function &lt;ob&gt;-&gt;&lt;func&gt;() resp. ">efun::filter()</a>), but must appear only in lambda-constructs.</p>
<div class="fragment"><div class="line">funcall(#<span class="stringliteral">&#39;return,4);  // does not work! This will raise an Uncallable-closure error.</span></div>
<div class="line"><span class="stringliteral">funcall(lambda(0, ({ (#&#39;</span><span class="keywordflow">return</span>),4 }) ));   <span class="comment">// this is a correct example</span></div>
</div><!-- fragment --><p> All operator-closures:</p>
<div class="fragment"><div class="line"><span class="preprocessor">#&#39;&amp;&amp;</span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor">#&#39;||</span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor">#&#39;,</span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor">#&#39;?</span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor">#&#39;?!</span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor">#&#39;=</span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor">#&#39;&lt;op&gt;=</span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor">#&#39;++</span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor">#&#39;--</span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor">#&#39;break</span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor">#&#39;catch</span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor">#&#39;continue</span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor">#&#39;default</span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor">#&#39;do</span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor">#&#39;foreach</span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor">#&#39;return</span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor">#&#39;sscanf</span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor">#&#39;switch</span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor">#&#39;while</span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor">#&#39;({</span></div>
<div class="line"><span class="preprocessor">#&#39;([</span></div>
</div><!-- fragment --><p> `#'..` is very likely to be an operator closure too, but since it is not implemented yet, I cannot say for sure.</p>
<h2>Variable-Closures</h2>
<p>All object-global variables might be "closured" by prepending a <code>#'</code> to them to allow access and/or manipulation of them. So if your object has a global variable x you can use <code>#'x</code> within a closure.</p>
<p>Normally you will treat those expressions like lfun-closures: put them into an array to get the value:</p>
<p>Anybody who now calls <code>object-&gt;foo()</code> will get a closure which will, when evaluated, write the actual value of object's global variable x.</p>
<p>Variable closures do not accept arguments.</p>
<h1>Examples</h1>
<p>In this section I will give and explain some examples coming out of praxis. If the explanation seems to be in some cases too detailed this can be explained by the trial to allow the reader to read the examples section first ;-)</p>
<h2>Lfun-Closure</h2>
<p>An item with a complex long-description like a watch that shall always show the actual time will usually base upon the complex/item-class and give an lfun-closure as argument to the <code>set_long()</code> method.</p>
<p><em>watch.c</em>:</p>
<div class="fragment"><div class="line">inherit <span class="stringliteral">&quot;complex/item&quot;</span>;</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">string</span> my_long() {</div>
<div class="line">  <span class="keywordflow">return</span> (<span class="stringliteral">&quot;The watch is small and has a strange otherworldly&quot;</span></div>
<div class="line">    <span class="stringliteral">&quot; aura about it.\n&quot;</span></div>
<div class="line">    <span class="stringliteral">&quot;The current time is: &quot;</span>+ctime()+<span class="stringliteral">&quot;.\n&quot;</span>);</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">void</span> create() {</div>
<div class="line">  set_short(<span class="stringliteral">&quot;a little watch&quot;</span>);</div>
<div class="line">  set_id(({ <span class="stringliteral">&quot;watch&quot;</span>,<span class="stringliteral">&quot;little watch&quot;</span> }));</div>
<div class="line">  set_long(#<span class="stringliteral">&#39;my_long);  // the lfun-closure to the lfun my_long()</span></div>
<div class="line"><span class="stringliteral">}</span></div>
</div><!-- fragment --><h2>Lambda-Closure</h2>
<p>The example from 3.1 can also be written using a lambda-closure.</p>
<p><em>watch-lambda.c</em>:</p>
<div class="fragment"><div class="line">inherit <span class="stringliteral">&quot;complex/item&quot;</span>;</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">void</span> create() {</div>
<div class="line">  set_short(<span class="stringliteral">&quot;a little watch&quot;</span>);</div>
<div class="line">  set_id(({ <span class="stringliteral">&quot;watch&quot;</span>,<span class="stringliteral">&quot;little watch&quot;</span> }));</div>
<div class="line">  set_long(lambda(</div>
<div class="line">    0,</div>
<div class="line">    ({</div>
<div class="line">      (#<span class="stringliteral">&#39;+),</span></div>
<div class="line"><span class="stringliteral">      &quot;The watch is small and has a strange&quot;</span></div>
<div class="line"><span class="stringliteral">      &quot; otherworldly aura about it.\n&quot;</span></div>
<div class="line"><span class="stringliteral">      &quot;The current time is: &quot;,</span></div>
<div class="line"><span class="stringliteral">      ({</span></div>
<div class="line"><span class="stringliteral">        (#&#39;</span>+),</div>
<div class="line">        ({ (#<span class="stringliteral">&#39;ctime) }),</span></div>
<div class="line"><span class="stringliteral">        &quot;.\n&quot;</span></div>
<div class="line"><span class="stringliteral">      })</span></div>
<div class="line"><span class="stringliteral">    })</span></div>
<div class="line"><span class="stringliteral">  ));</span></div>
<div class="line"><span class="stringliteral">}</span></div>
</div><!-- fragment --> </div></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="driver_syntax_overview.html">LPC syntax</a></li>
    <li class="footer">Generated on Thu Mar 9 2017 17:45:24 for LDMud by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.6 </li>
  </ul>
</div>
</body>
</html>
