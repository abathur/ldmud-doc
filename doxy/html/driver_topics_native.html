<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.6"/>
<title>LDMud: `native` driver mode</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">LDMud
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.6 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('driver_topics_native.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">`native` driver mode </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>During the evolution of LPMud there has been a hiatus as the old driver became too restricting for the demands of modern muds: it did a lot of things the mudlib could do better or completely different. Removing these things from the driver weren't a problem, but to keep compatible with the existing mudlibs (namely the well-known 2.4.5 lib), it was possible to undo these changes. First by setting a runtime option, then by compiling the driver either in 'compat' or in 'native' mode.</p>
<p>Starting with 3.2.1, the distinction between compat and native mode is more and more transferred into the mudlib, with the future goal of having a modeless driver.</p>
<p>Starting with 3.2.7, native mode no longer exists as such, only 'plain' (quasi a superset of 'native' and 'compat') and 'compat' mode, and since 3.2.9 the mode selection can be made via commandline option.</p>
<p>The main mode of the driver is determined at compile time by preprocessor symbols to be defined/undefined in config.h:</p>
<p>COMPAT_MODE: when defined, the compat mode specifics are activated by default.</p>
<p>Additional modifications can be achieved by the specification of commandline arguments (most of them have a default setting entry in config.h as well):</p>
<p>strict-euids: when active, euid usage is enforced. compat: when active, the compat mode is used.</p>
<p>Following is the description of the changes (de) activated by these defines. A shorthand notation is used: 'compat' means 'if compat mode is active' and '!compat' means 'if compat mode is not active', etc.</p>
<p>Predefined Preprocessor Symbols</p>
<ul>
<li>If compat, the symbols <a class="el" href="driver_topics_predefined.html">COMPAT_FLAG</a> and <a class="el" href="driver_topics_predefined.html">__COMPAT_MODE__</a> are defined for all LPC programs.</li>
<li>If strict-euids, the symbol <a class="el" href="driver_topics_predefined.html">__STRICT_EUIDS__</a> is defined for all LPC programs.</li>
<li>For compatibility reasons, the symbol <a class="el" href="driver_topics_predefined.html">__EUIDS__</a> is defined for all LPC programs all the time.</li>
</ul>
<p>Preloading Of Objects The driver has the possibility to preload objects before the game is actually opened to the world. This is done by calling <a class="el" href="classmaster.html#ab703ef439d80a2105e52cb19d12aa1de" title="Perform final actions before opening the system to users. ">master::epilog()</a>, which has to return 0 or an array. If its an array, its elements (as long as they are strings) are given one by one as argument to <a class="el" href="classmaster.html#a77bb5c507495689cfc9e4d8d6784421c" title="Load the object with the given file name (which was returned by master::epilog()). ">master::preload()</a> which may now preload the objects (or do anything else).</p>
<p>Initialisation Of Objects It is task of the mudlib (through the driver hooks) to call the initialisation lfuns in newly created objects. The following table shows the traditional calls:</p>
<div class="fragment"><div class="line">       mode        : init call : reset call</div>
<div class="line">--------------------------------------------</div>
<div class="line"> !compat &amp; !native :  create() :  reset(1)</div>
<div class="line"> !compat &amp;  native :  create() :  reset()</div>
<div class="line">  compat &amp; !native :  reset(0) :  reset(1)</div>
<div class="line">  compat &amp;  native :  reset(0) :  reset(1)</div>
</div><!-- fragment --><p> If INITIALIZATION_BY___INIT was defined, the lfun __INIT() is called first on creation to initialize the objects variables.</p>
<p>Movement Of Objects The <a class="el" href="classefun.html#a4190a089c412b88e938a4a34865e8366" title="The item, which can be an object_name or an object, is moved into it&#39;s new environment dest...">efun::move_object()</a> is implemented in the mudlib through driver hooks and the <a class="el" href="classefun.html#af10a6a3226140343c43ee7b4d0c4878b" title="The item is moved into its new environment env, which may be 0. ">efun::set_environment()</a>. <a class="el" href="classefun.html#a4190a089c412b88e938a4a34865e8366" title="The item, which can be an object_name or an object, is moved into it&#39;s new environment dest...">efun::move_object()</a> itself exists just for convenience and compatibility.</p>
<p>In original native mode, <a class="el" href="classefun.html#a4190a089c412b88e938a4a34865e8366" title="The item, which can be an object_name or an object, is moved into it&#39;s new environment dest...">efun::move_object()</a> could applied only to <code>this_object()</code> as the object to move, and it called the lfun <code>exit()</code> in the old environment if in compat mode. As a side effect, <a class="el" href="classefun.html#aa1a689311c00f31fcf25985a16a6eaef" title="Set up a local function fun to be called when user input matches the command cmd. ...">efun::add_action()</a> may not target the lfun <code>exit()</code> in compat mode.</p>
<p>In compat mode, objects may be moved using the <a class="el" href="classefun.html#a005a3e81b3a804ec38fbbe1fdadd7beb" title="This efun is for backward compatibility only. ">efun::transfer()</a>. It does make assumptions about the design of the mudlib, though, as it calls the lfuns <a class="el" href="classapplied.html#a1bce9b016a6d9bd6f9044722d43f7792" title="In compat mode this lfun is used by efun::transfer(). ">applied::query_weight()</a>, <a class="el" href="classapplied.html#a4b5d45018717363600be57c0400c37dc" title="In compat mode, this function is used by efun::transfer(). ">applied::can_put_and_get()</a>, <a class="el" href="classapplied.html#a84a9cd93622aa531274dd4c027f006ce" title="In compat mode, this function is used by efun::transfer(). ">applied::get()</a>, <a class="el" href="classapplied.html#a60fb09d965441f9502f358d6d10e043c" title="In compat mode, this function is used by efun::transfer(). ">applied::prevent_insert()</a> and <a class="el" href="classapplied.html#a8cec8ec81cb7af8d65f18f84cf745f0f" title="In compat mode, this function is used by efun::transfer(). ">applied::add_weight()</a>.</p>
<p>Efuns In General <a class="el" href="classefun.html#a55343a0ba8533a02cda89031a6fa91b7" title="This efun is for backward compatibility only. ">efun::creator()</a>, <a class="el" href="classefun.html#a005a3e81b3a804ec38fbbe1fdadd7beb" title="This efun is for backward compatibility only. ">efun::transfer()</a> These exist only in compat mode (<a class="el" href="classefun.html#a55343a0ba8533a02cda89031a6fa91b7" title="This efun is for backward compatibility only. ">efun::creator()</a> is identical with <a class="el" href="classefun.html#a1cee8cfd71595afe5cb29db76705b601" title="User-ids are not used in compat mode. ">efun::getuid()</a>).</p>
<p><a class="el" href="classefun.html#a4eae6e47ac233059b5613c83cf5855e0" title="Get the name of an object ob or, if no argument is given, of the current object. ">efun::object_name()</a>, <a class="el" href="classefun.html#a5d01aa2cfe41a64bb709d8ef3db87b58" title="Look up a function str in the current object, respectively in the object ob. ">efun::function_exists()</a> In !compat mode, the returned filenames start with a leading '/', in compat mode they don't.</p>
<p><a class="el" href="classefun.html#a0a52a8bbc893c49d46cb6f61fa5ea07a" title="efun::parse_command() is basically a spiffed up sscanf operating on word basis and targeted at recogn...">efun::parse_command()</a> This command exists in two versions: the old is used with compat, the new with !compat. However, SUPPLY_PARSE_COMMAND must be defined in config.h in both cases (this efun is not very useful at all).</p>
<p><a class="el" href="classefun.html#a58338c1e30d3a60a84db85cc2680684b" title="Searches string str for occurences of a &quot;value by function call&quot;, which is an implicit function call ...">efun::process_string()</a> If <code>this_object()</code> doesn't exist, it defaults to <code>this_player()</code> and receives the backbone uid (returned by <a class="el" href="classmaster.html#aadf9def996105f666c5c6b6a82de53d7" title="This method is called when efun::process_string() is used without a current object (e...">master::get_bb_uid()</a>) as euid. If strict-euids, this uid must not be 0.</p>
<p>Userids and Effective Userids This is probably the most important difference between the modes.</p>
<p>LPMud always had userids (uids) attributing the objects, though they were called 'creator names' in compat mode. Internally, the compat mode uses the 'creator names' as (e)uid.</p>
<p>With the introduction of native/plain mode, additionally 'effective userids' (euids) were introduced to improve security handling (which was only a partial success). The hardcoded handling of euids and uids was quite complex and too mudlib-insensitive, so most of it got moved from the driver into the mudlib with 3.2.1.</p>
<p>In strict-euids mode, only objects with a non-zero euid may load or create new objects.</p>
<h2>In Detail</h2>
<p>Userids of the Master The master's (e)uid is determined by a call to <a class="el" href="classmaster.html#a00e2058d1da4ecd4112c1fce39dbfbce" title="Return the string to be used as root-uid. ">master::get_master_uid()</a>.</p>
<p>In strict-euids mode, the result has to be a string, otherwise the driver won't start up at all. If the result is valid it is set as the master's uid and euid.</p>
<p>In !strict-euids mode, the result may be any value: 0 or a string are treated as the uid to set, a non-zero integer leads to the use of the uid set in the default 'global' wizlist entry, and any other value defaults to 0. The euid is either set to the returned string (if any), or to 0.</p>
<p>The master's uid is determined only on startup this way; at runtime the uids of a reloaded master determined as for every object by a call to the appropriate driver hooks.</p>
<p>Userids of New Objects To determine the (e)uids for a new object (loaded or inherited, or cloned), the appropriate driver hook is evaluated (<a class="el" href="driver_hook_load_uids.html">H_LOAD_UIDS</a>, <a class="el" href="driver_hook_clone_uids.html">H_CLONE_UIDS</a>) and the result set as (e)uid. The result may be a single value, in which case the euid is set to 0, or an array <code>({ uid, euid })</code>.</p>
<p>In strict-euids mode, both uid and euid must be 0 or a string, any other value causes the load/clone to fail.</p>
<p>In !strict-euids mode, the uid (however returned) may also be a non-zero integer to use the uid of the global wizlist entry as uid. The euid is then set to either 0 or the second entry of the returned array if it's a string.</p>
<dl class="section see"><dt>See Also</dt><dd><a class="el" href="driver_hook_overview.html">hook</a>, <a class="el" href="classefun.html#a4190a089c412b88e938a4a34865e8366" title="The item, which can be an object_name or an object, is moved into it&#39;s new environment dest...">efun::move_object()</a> </dd></dl>
</div></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="driver_topics_overview.html">Other topics</a></li>
    <li class="footer">Generated on Thu Mar 9 2017 17:45:24 for LDMud by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.6 </li>
  </ul>
</div>
</body>
</html>
