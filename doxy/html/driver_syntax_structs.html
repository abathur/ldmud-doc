<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.6"/>
<title>LDMud: structs</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">LDMud
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.6 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('driver_syntax_structs.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">structs </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>declare ::= struct struct_name; define ::= struct name (parent) {int one;}; construct ::= (&lt;struct_name&gt;) (&lt;struct_name&gt; 1) (&lt;struct_name&gt; one: 1) test (* comment *) test struct_name ::= beeps</p>
<p>declare ::= struct struct_name; define ::= struct name (parent) {int one;}; construct ::= (&lt;struct_name&gt;) (&lt;struct_name&gt; 1) (&lt;struct_name&gt; one: 1) test (* comment *) test struct_name ::= beeps</p>
<p>Structs are, next to arrays and mappings, a way to group a collection of values together. A struct holds a fixed number of values, called 'members', and allows to access them by their given name. The name is resolved when the LPC code is compiled, making struct member access as fast as array member access.</p>
<p>Structs are passed by reference. struct_name</p>
<h2>DEFINING</h2>
<p>A new struct type has to be defined at the top level of an object. For example:</p>
<div class="fragment"><div class="line"><span class="keyword">struct </span>Foo {</div>
<div class="line">  <span class="keywordtype">int</span>        one, *two;</div>
<div class="line">  <span class="keyword">struct </span>Bar three;</div>
<div class="line">};</div>
</div><!-- fragment --><p> defines the new struct 'Foo' with three members: integer 'one', integer array 'two', and struct Bar 'three'</p>
<p>It is possible to 'inherit' structs from each other. Given above definition of struct Foo, the following definition</p>
<div class="fragment"><div class="line"><span class="keyword">struct </span>Quux (Foo) {</div>
<div class="line">  <span class="keywordtype">int</span> four;</div>
<div class="line">};</div>
</div><!-- fragment --><p> is equivalent to the definition:</p>
<div class="fragment"><div class="line"><span class="keyword">struct </span>Quux {</div>
<div class="line">  <span class="keywordtype">int</span>        one, *two;</div>
<div class="line">  <span class="keyword">struct </span>Bar three;</div>
<div class="line">  <span class="keywordtype">int</span> four;</div>
<div class="line">};</div>
</div><!-- fragment --><p> The usual visibility modifiers apply, e.g.</p>
<div class="fragment"><div class="line"><span class="keyword">protected</span> <span class="keyword">struct </span>Bang {...};</div>
</div><!-- fragment --><p> struct definitions are promoted through inheritance like functions, with the difference that all structs live in the same flat namespace. This means: a struct defined in a program is visible in <em>all</em> inherited programs, regardless of how deep the inheritance is nested. This also means that in one program there must not be two structs, inherited or not, with the same name.</p>
<p>To declare a struct without defining it, write:</p>
<div class="fragment"><div class="line"><span class="keyword">struct </span>Quux;</div>
</div><!-- fragment --><p> This notation is useful if you have two structs referencing each other:</p>
<div class="fragment"><div class="line"><span class="keyword">struct </span>Quux;</div>
<div class="line"></div>
<div class="line"><span class="keyword">struct </span>Bar {</div>
<div class="line">  <span class="keyword">struct </span>Quux quux;</div>
<div class="line">};</div>
<div class="line"><span class="keyword">struct </span>Quux {</div>
<div class="line">  <span class="keyword">struct </span>Bar bar;</div>
<div class="line">};</div>
</div><!-- fragment --><h2>CREATING</h2>
<p>To use a struct, its definition must be visible - either because it is defined in the object compiled, or it has been inherited.</p>
<dl class="section user"><dt>note: #include'ing structs does not what you think it does: in LPC it constructs a new struct type whereever it is included.</dt><dd></dd></dl>
<p>A variable to hold a struct is defined like this:</p>
<div class="fragment"><div class="line"><span class="keyword">struct </span>Foo var;</div>
</div><!-- fragment --><p> and similar for function arguments:</p>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> fun (<span class="keyword">struct</span> Foo arg)</div>
</div><!-- fragment --><p> Just writing 'struct Foo var' however does not <em>create</em> a struct, it just creates a variable capable of holding one. To assign a value to the variable upon creation, assign it with a struct value, either from another variable or from a literal struct:</p>
<div class="fragment"><div class="line"><span class="keyword">struct </span>Foo var = (&lt;Foo&gt;);</div>
</div><!-- fragment --><p> Literal structs are written using <code>(&lt;&gt;)</code> as delimiters:</p>
<p><code>(&lt;Foo&gt;)</code> creates an empty instance of struct Foo</p>
<p><code>(&lt;Foo&gt; 1, ({ 2 }), bar)</code> creates an instance of struct Foo, and assigns <code>1</code> to member 'one', <code>({ 2 })</code> to member 'two', and the content of variable <code>bar</code> to member 'three'.</p>
<p><code>(&lt;Foo&gt; two: ({ 2 }) )</code> creates an instance of struct Foo which is all empty except for member 'two' which is assigned the value <code>({ 2 })</code>.</p>
<p>It is not possible to use both named and unnamed initializers in the same literal.</p>
<h2>USAGE IN CLOSURES</h2>
<p>The `#'(&lt;` operator can be used in lambda closures to create a struct; the type of the struct is given by the 'template' struct passed as first argument. The content of the template struct is irrelevant, so an empty struct suffices. For example, to create an instance of struct Foo:</p>
<div class="fragment"><div class="line">({ #<span class="stringliteral">&#39;(&lt;, (&lt;Foo&gt;), 1, ({ 2 }), (&lt;Bar&gt;) })</span></div>
</div><!-- fragment --><p> The order of the member values is the order in which they appear in the struct definition.</p>
<p>To access a struct member in a lambda closure, use the `#'-&gt;` operator with the name of the member as double-quoted symbol or literal string:</p>
<div class="fragment"><div class="line">({ #<span class="stringliteral">&#39;-&gt;, struct-expression, &#39;</span><span class="stringliteral">&#39;one })</span></div>
<div class="line"><span class="stringliteral">({ #&#39;</span>-&gt;, <span class="keyword">struct</span>-expression, <span class="stringliteral">&quot;one&quot;</span> })</div>
</div><!-- fragment --><h2>SYNTAX</h2>
<p>Dunno yet:</p>
<p>struct_definition ::= "struct " struct_name ["(" struct_name ")"] "{" variable_declaration* "};" struct_declaration ::= "struct " struct_name ";" struct_name ::= identifier literal ::= "(&lt;" struct_name "&gt;)"</p>
<h2>MISCELLANEOUS</h2>
<p>Internally structs can be identified by the ID string returned from <a class="el" href="classefun.html#ac251ce3e185e6ef6e265806ba711e871" title="Returns info about the type of value, as controlled by the flag. ">efun::get_type_info()</a>. This string contains the name of the struct, the name of the program its type was defined in, and the ID number of the program. However, do not rely on a particular format of this string!</p>
<p>Support for structs is signaled by the <a class="el" href="driver_topics_predefined.html">__LPC_STRUCTS__</a>.</p>
<p>Though structs are tied to the program the are defined in, re-compiling a program doesn't make the struct types incompatible. Even if the newly compiled struct has a different structure it will be accepted by routines that expect the old struct definition. When members disappeared in the new struct definition, read access to those members will return 0, write access to vanished members however will result in a runtime error.</p>
<dl class="section user"><dt>Usage:</dt><dd><p class="startdd">Suppose we have two objects: a monster, and a monster coordinate tracker, and we want to use a struct to store the coordinate:</p>
<p class="enddd"></p>
</dd></dl>
<dl class="section user"><dt>note: Using #include "monster_coordinate.c" instead of  driver_syntax_inherit "inherit" won't work. While the objects would compile, the first call to track() would cause a runtime error similar to: Illegal type to struct-&gt;(): struct Coordinate (/monster.c #234), expected struct Coordinate (/monster_tracker.c #552)</dt><dd></dd></dl>
<dl class="section user"><dt>History:</dt><dd><div class="fragment"><div class="line">introduced (3.3.246)</div>
<div class="line">changed (3.3.344) -- implementation revised</div>
<div class="line">changed (3.3.417) -- implemented reactivation of unchanged structs in <span class="keywordtype">object</span> updates</div>
</div><!-- fragment --></dd></dl>
<dl class="section see"><dt>See Also</dt><dd><a class="el" href="driver_syntax_mappings.html">mapping</a>, <a class="el" href="classefun.html#ac251ce3e185e6ef6e265806ba711e871" title="Returns info about the type of value, as controlled by the flag. ">efun::get_type_info()</a>, <a class="el" href="classefun.html#a1f75bb586fd744aa865714d4bab27b34" title="Return 1 if arg is a struct. ">efun::structp()</a>, <a class="el" href="classefun.html#a6cd46ef2f89a1b7f5a4ec5f4cb7beee1" title="The first form returns a mapping with indices from arr1 and values from arr2... ">efun::mkmapping()</a>, <a class="el" href="classefun.html#a6744067ae555fa96eede33f8b186f2e8" title="The given array, mapping or struct data is returned as a struct. ">efun::to_struct()</a>, <a class="el" href="classefun.html#a8280ed5a59ba55516e4b7bd063283287" title="Return an array of information about the structure of struct st. ">efun::struct_info()</a>, <a class="el" href="classefun.html#a2b1d6366b19ef84232863b29facb9a42" title="Test if the type of struct b is a base of struct s (the values of b and s are irrelevant). ">efun::baseof()</a> </dd></dl>
</div></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="driver_syntax_overview.html">LPC syntax</a></li>
    <li class="footer">Generated on Thu Mar 9 2017 17:45:24 for LDMud by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.6 </li>
  </ul>
</div>
</body>
</html>
