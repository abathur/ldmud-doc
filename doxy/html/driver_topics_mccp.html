<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.6"/>
<title>LDMud: The Mud Client Compression Protocol</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">LDMud
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.6 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('driver_topics_mccp.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">The Mud Client Compression Protocol </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>Information and code taken from the <a class="el" href="driver_topics_mccp.html">MCCP</a> Homepage driver_http:__www.randomly.org_projects_MCCP_ "http://www.randomly.org/projects/MCCP/"</p>
<p><a class="el" href="driver_topics_mccp.html">MCCP</a> is implemented as a Telnet option [RFC854, RFC855]. The server and client negotiate the use of <a class="el" href="driver_topics_mccp.html">MCCP</a> as they would any other telnet option. Once agreement has been reached on the use of the option, option subnegotiation is used to determine acceptable compression methods to use, and to indicate the start of a compressed data stream.</p>
<p>If the driver is compiled with <a class="el" href="driver_topics_mccp.html">MCCP</a> Support there is a define <a class="el" href="driver_topics_predefined.html">__MCCP__</a>.</p>
<p>The driver currently supports both versions of mccp. If your mud has a <a class="el" href="driver_hook_no_echo.html">H_NOECHO</a> hook you have to find out if the client supports mccp. Without this hook you still have to start neogotiation.</p>
<p>All sub-negotiation is done by <a class="el" href="classefun.html#a0942012412ffa3f64f1d7c92352a805e" title="This efun must be called inside an interactive player and starts the compression of the driver -&gt; cli...">efun::start_mccp_compress()</a> and <a class="el" href="classefun.html#ab7f14bd8da9ff16ac3c60d868af1aedb" title="This efun must be called inside an interactive player and stops the compression of the driver -&gt; clie...">efun::end_mccp_compress()</a> whether you have this hook or not.</p>
<dl class="section user"><dt>note: when the client uses compressions all binary_message calls are executed with flag=3. This is because writing to the socket would disturb zlib stream.</dt><dd></dd></dl>
<p>mccp-efuns:</p>
<ul>
<li><a class="el" href="classefun.html#a0942012412ffa3f64f1d7c92352a805e" title="This efun must be called inside an interactive player and starts the compression of the driver -&gt; cli...">efun::start_mccp_compress()</a> (only needed with <a class="el" href="driver_hook_no_echo.html">H_NOECHO</a>)</li>
<li><a class="el" href="classefun.html#ab7f14bd8da9ff16ac3c60d868af1aedb" title="This efun must be called inside an interactive player and stops the compression of the driver -&gt; clie...">efun::end_mccp_compress()</a> (only needed with <a class="el" href="driver_hook_no_echo.html">H_NOECHO</a>)</li>
<li><a class="el" href="classefun.html#af6515b75af0e981f626dc18cab2c5e82" title="This efun returns current whether the client uses compression or not ( default this_player() )...">efun::query_mccp()</a></li>
<li><a class="el" href="classefun.html#afe44b8bace8716fb752a644c53fa1258" title="This efun gives you statistics about current compression of the player ( default this_player() )...">efun::query_mccp_stats()</a></li>
</ul>
<p>Initiating <a class="el" href="driver_topics_mccp.html">MCCP</a> without <a class="el" href="driver_hook_no_echo.html">H_NOECHO</a> hook:</p>
<div class="fragment"><div class="line"><span class="keywordflow">if</span>(!query_mccp()){</div>
<div class="line">  binary_message(({ IAC, WILL, TELOPT_COMPRESS2 }),1)</div>
<div class="line">  binary_message(({ IAC, WILL, TELOPT_COMPRESS }),1)</div>
<div class="line">}</div>
</div><!-- fragment --><p> the driver will parse the client's answers and start compression. (The connection might already be compressed, because although the documentation says clients should not negotiate from themselves, zmud e.g. does.)</p>
<p>You can start and stop compression manually by efuns when you are sure client supports compression :)</p>
<p>Initiating <a class="el" href="driver_topics_mccp.html">MCCP</a> compression with <a class="el" href="driver_hook_no_echo.html">H_NOECHO</a> hook:</p>
<div class="fragment"><div class="line">If your mudlib uses the :hook:`H_NOECHO` driver-hook you decided to <span class="keywordflow">do</span></div>
<div class="line">all the negotiation by yourself:</div>
<div class="line"></div>
<div class="line">Server Commands</div>
<div class="line">IAC WILL COMPRESS  indicates the sender supports version 1 of the</div>
<div class="line">                   protocol, and is willing to compress data it sends.</div>
<div class="line"></div>
<div class="line">IAC WILL COMPRESS2 indicates the sender supports version 2, and is</div>
<div class="line">                   willing to compress data it sends.</div>
<div class="line"></div>
<div class="line">IAC WONT COMPRESS  indicates the sender refuses to compress data <span class="keyword">using</span></div>
<div class="line">                   version 1.</div>
<div class="line"></div>
<div class="line">IAC WONT COMPRESS2 indicates the sender refuses to compress data</div>
<div class="line">                   <span class="keyword">using</span> version 2.</div>
<div class="line"></div>
<div class="line">Client Commands</div>
<div class="line">IAC DO COMPRESS    indicates the sender supports version 1 of the</div>
<div class="line">                   protocol, and is willing to decompress data</div>
<div class="line">                   received.</div>
<div class="line"></div>
<div class="line">IAC DO COMPRESS2   indicates the sender supports version 2 or above,</div>
<div class="line">                   and is willing to decompress data received.</div>
<div class="line"></div>
<div class="line">IAC DONT COMPRESS  indicates the sender refuses to support version 1.</div>
<div class="line">                   If compression was previously negotiated and is</div>
<div class="line">                   currently being used, the server should terminate</div>
<div class="line">                   compression.</div>
<div class="line"></div>
<div class="line">IAC DONT COMPRESS2 indicates the sender refuses to support version 2.</div>
<div class="line">                   If compression was previously negotiated and is</div>
<div class="line">                   currently being used, the server should terminate</div>
<div class="line">                   compression</div>
<div class="line"></div>
<div class="line">After you found out whether the client supports mccp or not you can</div>
<div class="line">start compression with start_mccp_compress(TELOPT_COMPRESS2) or</div>
<div class="line">start_mccp_compress(TELOPT_COMPRESS). ( you could start it without</div>
<div class="line">checking but some players would protest :) )</div>
</div><!-- fragment --><ul>
<li>author: Bastian Hoyer (driver_mailto:dafire.mud.de "dafire@ff.mud.de") (some text taken from project page)</li>
</ul>
<dl class="section user"><dt>History:</dt><dd><div class="fragment"><div class="line">introduced (3.3.447)</div>
<div class="line">backported (3.2.10)</div>
</div><!-- fragment --></dd></dl>
<dl class="section see"><dt>See Also</dt><dd><a class="el" href="classefun.html#a0942012412ffa3f64f1d7c92352a805e" title="This efun must be called inside an interactive player and starts the compression of the driver -&gt; cli...">efun::start_mccp_compress()</a>, <a class="el" href="classefun.html#ab7f14bd8da9ff16ac3c60d868af1aedb" title="This efun must be called inside an interactive player and stops the compression of the driver -&gt; clie...">efun::end_mccp_compress()</a>, <a class="el" href="classefun.html#af6515b75af0e981f626dc18cab2c5e82" title="This efun returns current whether the client uses compression or not ( default this_player() )...">efun::query_mccp()</a>, <a class="el" href="classefun.html#afe44b8bace8716fb752a644c53fa1258" title="This efun gives you statistics about current compression of the player ( default this_player() )...">efun::query_mccp_stats()</a> </dd></dl>
</div></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="driver_topics_overview.html">Other topics</a></li>
    <li class="footer">Generated on Thu Mar 9 2017 17:45:24 for LDMud by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.6 </li>
  </ul>
</div>
</body>
</html>
