<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.6"/>
<title>LDMud: syntax/closure_guide.md Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">LDMud
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.6 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('closure__guide_8md.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">syntax/closure_guide.md</div>  </div>
</div><!--header-->
<div class="contents">
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;closure_guide {#driver_syntax_closure_guide}</div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;============================================</div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160; Guide to closures #</div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;</div>
<div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;A closure is a pointer to a <span class="keyword">function</span>. That means that it is data like an <span class="keywordtype">int</span> or a <span class="keywordtype">string</span> are. It may be assigned to a variable or given to anoth- er <span class="keyword">function</span> as argument.</div>
<div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;</div>
<div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;# Overview and <a class="code" href="classefun.html">efun</a>-closures #</div>
<div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;</div>
<div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;To create a closure that points to an <a class="code" href="classefun.html">efun</a> (like <a class="code" href="classefun.html#afacd7cdaff7309a4b579f4c14db53662">efun::write</a>()) you can write the name of the <a class="code" href="classefun.html">efun</a> prepended with &quot;hash-tick&quot;: `<span class="preprocessor">#&#39;`. `#&#39;write` is a closure that points to efun::write().</span></div>
<div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;@par tip: If your editor gets confused by the hashmark, <span class="keywordflow">try</span> putting parentheses around such a closure-notation because otherwise my : (`#<span class="stringliteral">&#39;write`). This is especially of interest within lambda-closures (see below).</span></div>
<div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;<span class="stringliteral"></span></div>
<div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;<span class="stringliteral">A closure can be evaluated (which means that the function it points to is called) using efun::funcall() or efun::apply(), which also allow to give arguments to the function. Example:</span></div>
<div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;<span class="stringliteral"></span></div>
<div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;<span class="stringliteral">~~~{.c}</span></div>
<div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;<span class="stringliteral">funcall(#&#39;</span>write,<span class="stringliteral">&quot;hello&quot;</span>);</div>
<div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;</div>
<div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;~~~</div>
<div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;This will result in the same as `write(<span class="stringliteral">&quot;hello&quot;</span>);` alone. The <span class="keywordtype">string</span> <span class="stringliteral">&quot;hello&quot;</span> is given as first (and only) argument to the <span class="keyword">function</span> the closure `#<span class="stringliteral">&#39;write` points to.</span></div>
<div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;<span class="stringliteral"></span></div>
<div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;<span class="stringliteral">The return value of the function the closure points to is returned by efun::funcall() or efun::apply(). (Since efun::write() always returns 0 the return value of the example above will be 0.)</span></div>
<div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;<span class="stringliteral"></span></div>
<div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;<span class="stringliteral">What are closures good for? With closures you can make much more universally usable functions. A good example is the function efun::filter(). It gets an array and a closure as arguments. Then it calls the function the closure points to for each element of the array:</span></div>
<div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;<span class="stringliteral"></span></div>
<div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;<span class="stringliteral">~~~{.c}</span></div>
<div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;<span class="stringliteral">filter(({ &quot;bla&quot;,&quot;foo&quot;,&quot;bar&quot; }),#&#39;</span>write);</div>
<div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;</div>
<div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;~~~</div>
<div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;This will call `write(<span class="stringliteral">&quot;bla&quot;</span>)`, `write(<span class="stringliteral">&quot;foo&quot;</span>)` and `write(<span class="stringliteral">&quot;bar&quot;</span>)` in any order; the order is undefined. (In the current implementation the given closure is evaluated <span class="keywordflow">for</span> all elements from the first to the last, so the output will be <span class="stringliteral">&quot;blafoobar&quot;</span>.)</div>
<div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;</div>
<div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;Furthermore <a class="code" href="classefun.html#ac5e7282ed029a438608ee96f18052e33">efun::filter</a>() examines the return value of each call of the function the closure points to (the return value of <a class="code" href="classefun.html">efun</a>::write()). If the value is true (not 0) then this element is put into another array which <a class="code" href="classefun.html">efun</a>::filter() builds up. If the return value is false (== 0) then this element is _not_ put into this array. When all calls are done the slowly built up array is returned. Thus, <a class="code" href="classefun.html">efun</a>::filter() filters from the given array all elements that the given closure evaluates &quot;true&quot; for and returns an array of those. (The array given to <a class="code" href="classefun.html">efun</a>::filter() itself is _not_ changed!)</div>
<div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;</div>
<div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;A more sensical example for filter would be this:</div>
<div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;</div>
<div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;~~~{.c}</div>
<div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;x = filter(users(),#<span class="stringliteral">&#39;query_is_wizard);</span></div>
<div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;<span class="stringliteral"></span></div>
<div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;<span class="stringliteral">~~~</span></div>
<div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;<span class="stringliteral">efun::users() is an efun that gets no arguments and returns an array of all logged in players (wizards and players). `query_is_wizard` is a simul_efun that gets an object as first (and only) argument and returns true (1) if this object is a wizard and 0 otherwise.</span></div>
<div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;<span class="stringliteral"></span></div>
<div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;<span class="stringliteral">So, for each element of the array returned by efun::users() the function `query_is_wizard` is called and only those for which 1 was returned are collected into the result and then put into the variable x.</span></div>
<div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;<span class="stringliteral"></span></div>
<div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;<span class="stringliteral">We now have all logged in wizards stored as array in the variable x.</span></div>
<div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;<span class="stringliteral"></span></div>
<div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;<span class="stringliteral">Another example: We want to filter out all numbers that are greater than 42 from the array a of integers:</span></div>
<div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;<span class="stringliteral"></span></div>
<div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;<span class="stringliteral">~~~{.c}</span></div>
<div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;<span class="stringliteral">x = filter(({ 10,50,30,70 }),#&#39;</span>&gt;,42); <span class="comment">// x is now ({ 50,70 })</span></div>
<div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;</div>
<div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;~~~</div>
<div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;Here two things are <span class="keyword">new</span>: first: we create a closure that points to an <span class="keyword">operator</span>; second: we use the possibility to give extra arguments to <a class="code" href="classefun.html#ac5e7282ed029a438608ee96f18052e33">efun::filter</a>().</div>
<div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;</div>
<div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;Like all efuns the usual operators can be pointed to with a closure by prepending `#<span class="stringliteral">&#39;` to them. `funcall(#&#39;</span>&gt;,4,5)` is exactly the same as `(4&gt;5)`.</div>
<div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;</div>
<div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;The extra arguments given as third to last argument (as many as you like) to <a class="code" href="classefun.html#ac5e7282ed029a438608ee96f18052e33">efun::filter</a>() are given as second to last argument to the function pointed to by the closure each time it is called.</div>
<div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;</div>
<div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;Thus we now call ```(({ 10,50,30,70 })[0]&gt;42)```, ```(({ 10,50,30,70 })[1]&gt;42)``` ... (which is `(``10&gt;42)`, `(50&gt;42)` ...) and <span class="keywordflow">return</span> an array of all elements <span class="keyword">this</span> returns <span class="keyword">true</span> <span class="keywordflow">for</span> and store it into x.</div>
<div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;</div>
<div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;If you want to create a closure to an <a class="code" href="classefun.html">efun</a> of which you have the name stored in a <span class="keywordtype">string</span> you can create such an <a class="code" href="classefun.html">efun</a>-closure with <a class="code" href="classefun.html#a6f70cb143146d31cee7c413d2f0a0b9a">efun::symbol_function</a>():</div>
<div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;</div>
<div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;~~~{.c}</div>
<div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;symbol_function(<span class="stringliteral">&quot;write&quot;</span>) <span class="comment">// this will return #&#39;write</span></div>
<div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;</div>
<div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;funcall(symbol_function(&quot;write&quot;),&quot;foobar&quot;);  <span class="comment">// == write(&quot;foobar&quot;);</span></div>
<div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;</div>
<div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;~~~</div>
<div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;This function does not very often occur in normal code but it is very useful for tool-programming (eg the robe uses <a class="code" href="classefun.html">efun</a>::symbol_function() to allow you call any <a class="code" href="classefun.html">efun</a> you give).</div>
<div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;</div>
<div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;<span class="preprocessor"># Lfun- and Lambda-Closures #</span></div>
<div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;Very often the possibilities closures to efuns offer are not sufficient <span class="keywordflow">for</span> the purpose one has. In nearly all cases three possibilities exist in such cases: use an lfun- or <span class="keyword">inline</span>-closure, or a lambda-closure.</div>
<div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;</div>
<div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;## Lfun-Closures #</div>
<div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;</div>
<div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;The first possibility is rather easy: like with the <a class="code" href="classefun.html">efun</a>-closures you can create a pointer to a <span class="keyword">function</span> in the same <span class="keywordtype">object</span> you are by <span class="keyword">using</span> the `#<span class="stringliteral">&#39;` to prepend it to a function name of a function declared above. Example:</span></div>
<div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;<span class="stringliteral"></span></div>
<div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;<span class="stringliteral">~~~{.c}</span></div>
<div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;<span class="stringliteral">status foo(int x) {</span></div>
<div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;<span class="stringliteral">  return ((x*2) &gt; 42);</span></div>
<div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;<span class="stringliteral">}</span></div>
<div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;<span class="stringliteral"></span></div>
<div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;<span class="stringliteral">int *bar() {</span></div>
<div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;<span class="stringliteral">  return filter(({ 10,50,30,70 }),#&#39;</span>foo);</div>
<div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;}</div>
<div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;</div>
<div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;~~~</div>
<div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;Thus, `#<span class="stringliteral">&#39;foo` is used like there was an efun of this name and doing the job that is done in `foo()`.</span></div>
<div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;<span class="stringliteral"></span></div>
<div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;<span class="stringliteral">## Inline Closures #</span></div>
<div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;<span class="stringliteral"></span></div>
<div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;<span class="stringliteral">Inline closures are a variant of lfun closures, the difference being that the function text is written right where the closure is used, enclosed in a pair of `(:` and `:)`. The compiler will then take care of creating a proper lfun and lfun-closure. The arguments passed to such an inline closure are accessible by position: `$1` would be the first argument, `$2` the second, and so on. With this, the above example would read:</span></div>
<div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;<span class="stringliteral"></span></div>
<div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;<span class="stringliteral">~~~{.c}</span></div>
<div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;<span class="stringliteral">int * bar() {</span></div>
<div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;<span class="stringliteral">  return filter(({ 10,50,30,70 }), (: ($1 * 2) &gt; 42 :));</span></div>
<div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;<span class="stringliteral">}</span></div>
<div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;<span class="stringliteral"></span></div>
<div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;<span class="stringliteral">~~~</span></div>
<div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;<span class="stringliteral">or alternatively:</span></div>
<div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;<span class="stringliteral"></span></div>
<div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;<span class="stringliteral">~~~{.c}</span></div>
<div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;<span class="stringliteral">int * bar() {</span></div>
<div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;<span class="stringliteral">  return filter(({ 10,50,30,70 }), (: return ($1 * 2) &gt; 42; :));</span></div>
<div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;<span class="stringliteral">}</span></div>
<div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;<span class="stringliteral"></span></div>
<div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;<span class="stringliteral">~~~</span></div>
<div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;<span class="stringliteral">The difference between the two versions is that in the first form the text of the inline closure must be an expression only, whereas in the second form any legal statement is allowed. The compiler distinguishes the two forms by the last character before the `:)`: if it&#39;</span>s a `;` or `}`, the compiler treats the closure as statement(s), otherwise as expression.</div>
<div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;</div>
<div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;Inline closures may also nested, so that the following (not very useful) example is legal, too:</div>
<div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;</div>
<div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;~~~{.c}</div>
<div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;<span class="keywordflow">return</span> filter(</div>
<div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;  ({ 10, 50, 30, 70 }),</div>
<div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;  (: <span class="keywordtype">string</span> *s;</div>
<div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;    s = map(users(), (: $1-&gt;query_name() :));</div>
<div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;    <span class="keywordflow">return</span> s[random(<span class="keyword">sizeof</span>(s))] + ($1 * 2);</div>
<div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;  :)</div>
<div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;);</div>
<div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;</div>
<div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;~~~</div>
<div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;The notation of <span class="keyword">inline</span> closures is modelled after the MudOS functionals, but there are a few important differences in behaviour.</div>
<div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;</div>
<div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;## Lambda-Closures #</div>
<div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;</div>
<div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;Lambda-Closures take the idea of <span class="stringliteral">&#39;define it where you use it&#39;</span> one step further. On first glance they may look like <span class="keyword">inline</span> closures with an uglier notation, but they offer a few increased possibilities. But first things first.</div>
<div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;</div>
<div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;The <a class="code" href="classefun.html">efun</a> <a class="code" href="classefun.html#a4ef2926c525dcf7e7d339d3f424b18a9">efun::lambda</a>() creates a function temporarily and returns a closure pointing to this function. <a class="code" href="classefun.html">efun</a>::lambda() therefor gets two arrays as arguments, the first is a list of all arguments the function shall expect and the second array is the code of the function (in a more or less complicated form; at least not in C- or LPC-syntax). The closure `<span class="preprocessor">#&#39;foo` from the example above could be notated as lambda-closure:</span></div>
<div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;~~~{.c}</div>
<div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;lambda(</div>
<div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;  ({ <span class="stringliteral">&#39;x }),</span></div>
<div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;<span class="stringliteral">  ({</span></div>
<div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;<span class="stringliteral">    (#&#39;</span>&gt;),</div>
<div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;    ({ (#<span class="stringliteral">&#39;*),&#39;</span>x,2 }),</div>
<div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;    42</div>
<div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;  })</div>
<div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;)</div>
<div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;</div>
<div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;~~~</div>
<div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;Now, the first argument is `({ <span class="stringliteral">&#39;x })`, an array of all arguments the function shall expect: 1 argument (called &#39;</span>x) is expected. Notice the strange notation <span class="keywordflow">for</span> <span class="keyword">this</span> argument with one single leading tick. Like The hash-tick to denote closures the leading tick is used to denote things called <span class="stringliteral">&quot;symbols&quot;</span>. They <span class="keywordflow">do</span> not differ much from strings and <span class="keywordflow">if</span> you <span class="keywordflow">do</span> not want to have a deeper look into closures you can leave it <span class="keyword">this</span> way.</div>
<div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;</div>
<div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;The second argument is an array. The first element of such an array must be an <a class="code" href="classefun.html">efun</a>- or an lfun-closure, the further elements are the arguments <span class="keywordflow">for</span> the <span class="keyword">function</span> <span class="keyword">this</span> closure points to. If such an argument is an array, it is treated alike; the first element must be a closure and the remaining elements are arguments (which of course also might be arrays ...).</div>
<div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;</div>
<div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;This leads to a problem: sometimes you want to give an array as an argument to a <span class="keyword">function</span>. But arrays in an array given to <a class="code" href="classefun.html#a4ef2926c525dcf7e7d339d3f424b18a9">efun::lambda</a>() are interpreted as code-arrays. To allow you to give an array as an argument within an array given to <a class="code" href="classefun.html">efun</a>::lambda(), you can use the function <a class="code" href="classefun.html">efun</a>::quote() to make your array to a quoted array (a quoted array is for an array what a symbol is for a <span class="keywordtype">string</span>):</div>
<div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;</div>
<div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;~~~{.c}</div>
<div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;lambda(0,</div>
<div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;  ({</div>
<div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;    (#<span class="stringliteral">&#39;sizeof),</span></div>
<div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;<span class="stringliteral">    quote(({ 10,50,30,70 }))</span></div>
<div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;<span class="stringliteral">  })</span></div>
<div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;<span class="stringliteral">)</span></div>
<div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;<span class="stringliteral"></span></div>
<div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;<span class="stringliteral">~~~</span></div>
<div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;<span class="stringliteral">For array constants, you can also use a single quote to the same effect:</span></div>
<div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;<span class="stringliteral"></span></div>
<div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;<span class="stringliteral">~~~{.c}</span></div>
<div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;<span class="stringliteral">lambda(0,</span></div>
<div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;<span class="stringliteral">  ({</span></div>
<div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;<span class="stringliteral">    (#&#39;</span><span class="keyword">sizeof</span>),</div>
<div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;    <span class="stringliteral">&#39;({ 10,50,30,70 })</span></div>
<div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;<span class="stringliteral">  })</span></div>
<div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;<span class="stringliteral">)</span></div>
<div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;<span class="stringliteral"></span></div>
<div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;<span class="stringliteral">~~~</span></div>
<div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;<span class="stringliteral">This lambda-closure points to a function that will return 4 (it will call efun::sizeof() for the array `({ 10,50,30,70 })`). Another thing: if we want to create a function that expects no arguments, we can give an empty array as first argument to efun::lambda() but we can give 0 as well to attain this. This is just an abbreviation.</span></div>
<div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;<span class="stringliteral"></span></div>
<div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;<span class="stringliteral">Lambda-closure constructs can become quite large and hard to read. The larger they become the harder the code is to read and you should avoid extreme cases. Very often the possibility to use an lfun or an inline instead of a large lambda shortens the code dramatically. Example:</span></div>
<div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;<span class="stringliteral"></span></div>
<div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;<span class="stringliteral">~~~{.c}</span></div>
<div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;<span class="stringliteral">status foo(object o) {</span></div>
<div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;<span class="stringliteral">  return environment(o)-&gt;query_level()&gt;WL_APPRENTICE;</span></div>
<div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;<span class="stringliteral">}</span></div>
<div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;<span class="stringliteral"></span></div>
<div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;<span class="stringliteral">x=filter(a,#&#39;</span>foo);</div>
<div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;</div>
<div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;~~~</div>
<div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;does the same as:</div>
<div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;</div>
<div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;~~~{.c}</div>
<div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;x=filter(</div>
<div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;  a,</div>
<div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;  lambda(</div>
<div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;    ({ <span class="stringliteral">&#39;o }),</span></div>
<div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;<span class="stringliteral">    ({</span></div>
<div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;<span class="stringliteral">      (#&#39;</span>&gt;),</div>
<div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;      ({</div>
<div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;        (#<span class="stringliteral">&#39;call_other),</span></div>
<div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;<span class="stringliteral">        ({ (#&#39;</span>environment),<span class="stringliteral">&#39;o }),</span></div>
<div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;<span class="stringliteral">        &quot;query_level&quot;</span></div>
<div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;<span class="stringliteral">      }),</span></div>
<div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;<span class="stringliteral">      WL_APPRENTICE</span></div>
<div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;<span class="stringliteral">    })</span></div>
<div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;<span class="stringliteral">  )</span></div>
<div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;<span class="stringliteral">);</span></div>
<div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;<span class="stringliteral"></span></div>
<div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;<span class="stringliteral">~~~</span></div>
<div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;<span class="stringliteral">@par note: the syntax with the arrow `-&gt;` for efun::call_other() cannot be used, `#&#39;</span>-&gt;` does not exist. You have to use `#<span class="stringliteral">&#39;call_other` for this and give the name of the lfun to be called as a string.)</span></div>
<div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;<span class="stringliteral"></span></div>
<div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;<span class="stringliteral">This example also demonstrates the two disadvantages of lambda closures. First, they are very difficult to read, even for a simple example like this. Second, the lambda closure is re-created everytime the efun::filter() is executed, even though the created code is always the same.</span></div>
<div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;<span class="stringliteral"></span></div>
<div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;<span class="stringliteral">&#39;</span>Why use lambdas at all then?<span class="stringliteral">&#39; you may ask now. Well, read on.</span></div>
<div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;<span class="stringliteral"></span></div>
<div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;<span class="stringliteral">### Advantages of Lambda Closures #</span></div>
<div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;<span class="stringliteral"></span></div>
<div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;<span class="stringliteral">The advantages of lambdas stem from the fact that they are created at runtime from normal arrays.</span></div>
<div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;<span class="stringliteral"></span></div>
<div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;<span class="stringliteral">This means that the behaviour of a lambda can be made dependant on data available only at runtime. For example:</span></div>
<div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;<span class="stringliteral"></span></div>
<div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;<span class="stringliteral">~~~{.c}</span></div>
<div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;<span class="stringliteral">closure c;</span></div>
<div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;<span class="stringliteral">c = lambda(0, ({#&#39;</span>-, ({ #<span class="stringliteral">&#39;time }), time() }) );</span></div>
<div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;<span class="stringliteral"></span></div>
<div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;<span class="stringliteral">~~~</span></div>
<div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;<span class="stringliteral">Whenever you now call this closure (`funcall(c)`) it will return the elapsed time since the closure was created.</span></div>
<div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;<span class="stringliteral"></span></div>
<div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;<span class="stringliteral">The second advantage of lambdas is that the arrays from which they are compiled can be constructed at runtime. Imagine a customizable prompt which can be configured to display the time, the environment, or both:</span></div>
<div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;<span class="stringliteral"></span></div>
<div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;<span class="stringliteral">~~~{.c}</span></div>
<div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;<span class="stringliteral">mixed code;</span></div>
<div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;<span class="stringliteral"></span></div>
<div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;<span class="stringliteral">code = ({ &quot;&gt; &quot; });</span></div>
<div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;<span class="stringliteral">if (user_wants_time)</span></div>
<div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;<span class="stringliteral">{</span></div>
<div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;<span class="stringliteral">  code = ({ #&#39;</span>+, ({ #<span class="stringliteral">&#39;ctime }), code });</span></div>
<div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;<span class="stringliteral">}</span></div>
<div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;<span class="stringliteral"></span></div>
<div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;<span class="stringliteral">if (user_wants_environment)</span></div>
<div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;<span class="stringliteral">{</span></div>
<div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;<span class="stringliteral">  code = ({</span></div>
<div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;<span class="stringliteral">    #&#39;</span>+,</div>
<div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;    ({</div>
<div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;      #<span class="stringliteral">&#39;to_string,</span></div>
<div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;<span class="stringliteral">      ({#&#39;</span>environment, ({#<span class="stringliteral">&#39;this_player }) })</span></div>
<div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;<span class="stringliteral">    }),</span></div>
<div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;<span class="stringliteral">    code</span></div>
<div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;<span class="stringliteral">  });</span></div>
<div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;<span class="stringliteral">}</span></div>
<div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;<span class="stringliteral">set_prompt(lambda(0, code));</span></div>
<div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;<span class="stringliteral"></span></div>
<div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;<span class="stringliteral">~~~</span></div>
<div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;<span class="stringliteral"></span></div>
<div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;<span class="stringliteral">### Free Variables in Lambda-Closure Constructs #</span></div>
<div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;<span class="stringliteral"></span></div>
<div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;<span class="stringliteral">You can use local variables in lambda constructs without declaring them, just use them. The only limitation is that you at first have to assign something to them. Give them as symbols like you do with the arguments. This feature does not make much sense without the use of complexer flow controlling features described below.</span></div>
<div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;<span class="stringliteral"></span></div>
<div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;<span class="stringliteral">The closure `#&#39;</span>=` is used to assign a value to something (like @ref driver_syntax_operators <span class="stringliteral">&quot;=&quot;</span>).</div>
<div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;</div>
<div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;### Special Efun-Closures and Operator-Closures <span class="keywordflow">for</span> Lambdas #</div>
<div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;</div>
<div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;There are some special closures that are supposed to be used only within a lambda construct. With them you can create nearly all code you can with regular LPC-code like loops and conditions.</div>
<div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;</div>
<div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;`#<span class="stringliteral">&#39;?`</span></div>
<div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;<span class="stringliteral">acts like the &quot;if&quot; statement in LPC. The first argument is the condition, the second is the code to be executed if the condition returns true. The following arguments can also be such couples of code-arrays that state a condition and a possible result. If at the end there is a single argument, it is used as the else-case if no condition returned true:</span></div>
<div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;<span class="stringliteral"></span></div>
<div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;<span class="stringliteral">~~~{.c}</span></div>
<div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;<span class="stringliteral">lambda(</span></div>
<div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;<span class="stringliteral">  ({ &#39;</span>x }),</div>
<div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;  ({</div>
<div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;    (#<span class="stringliteral">&#39;?),             // if</span></div>
<div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;<span class="stringliteral">    ({ (#&#39;</span>&gt;),<span class="stringliteral">&#39;x,5 }),  //    (x &gt; 5)</span></div>
<div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;<span class="stringliteral">    ({ (#&#39;</span>*),<span class="stringliteral">&#39;x,2 }),  //       result is x * 2;</span></div>
<div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;<span class="stringliteral">    ({ (#&#39;</span>&lt;),<span class="stringliteral">&#39;x,-5 }), // else if (x &lt; -5)</span></div>
<div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;<span class="stringliteral">    ({ (#&#39;</span>/),<span class="stringliteral">&#39;x,2 }),  //    result is x/2;</span></div>
<div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;<span class="stringliteral">    &#39;</span>x                 <span class="comment">// else result is x;</span></div>
<div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;  })</div>
<div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;)</div>
<div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;</div>
<div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;~~~</div>
<div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;</div>
<div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;`#<span class="stringliteral">&#39;?!`</span></div>
<div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;<span class="stringliteral">is like the `#&#39;</span>?` but it negates all conditions after evaluation and thus is like an ifnot in LPC (<span class="keywordflow">if</span> there were one).</div>
<div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;</div>
<div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;`#<span class="stringliteral">&#39;,`</span></div>
<div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;<span class="stringliteral">(which looks a bit strange) is the equivalent of the comma-operator in LPC and says: evaluate all arguments and return the value of the last. It is used to do several things inside a lambda-closure:</span></div>
<div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;<span class="stringliteral"></span></div>
<div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;<span class="stringliteral">~~~{.c}</span></div>
<div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;<span class="stringliteral">lambda(</span></div>
<div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;<span class="stringliteral">  ({ &#39;</span>x }),</div>
<div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;  ({</div>
<div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;    (#<span class="stringliteral">&#39;,),  // two commas necessary! one for the closure and one as delimiter in the array</span></div>
<div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;<span class="stringliteral">    ({ (#&#39;</span>write),<span class="stringliteral">&quot;hello world!&quot;</span> }),</div>
<div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;    ({ (#<span class="stringliteral">&#39;say),&quot;Foobar.&quot; })</span></div>
<div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;<span class="stringliteral">  })</span></div>
<div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;<span class="stringliteral">)</span></div>
<div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;<span class="stringliteral"></span></div>
<div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;<span class="stringliteral">~~~</span></div>
<div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;<span class="stringliteral"></span></div>
<div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;<span class="stringliteral">`#&#39;</span><span class="keywordflow">while</span>`</div>
<div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;acts like the LPC statement <span class="stringliteral">&quot;while&quot;</span> and repeats executing one code-array <span class="keywordflow">while</span> another returns <span class="keyword">true</span>. `#<span class="stringliteral">&#39;while` expects two or more arguments: the condition as first argument, then the result the whole expression shall have after the condition turns false (this is in many cases of no interest) and as third to last argument the body of the loop:</span></div>
<div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;<span class="stringliteral"></span></div>
<div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;<span class="stringliteral">~~~{.c}</span></div>
<div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;<span class="stringliteral">lambda(</span></div>
<div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;<span class="stringliteral">  0,</span></div>
<div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;<span class="stringliteral">  ({</span></div>
<div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;<span class="stringliteral">    (#&#39;</span>,),                 <span class="comment">// several things to do ...</span></div>
<div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;    ({ (#<span class="stringliteral">&#39;=),&#39;</span>i,0 }),      <span class="comment">// i is a local variable of this lambda-closure and is initialized with 0 now.</span></div>
<div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;    ({</div>
<div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;      (#<span class="stringliteral">&#39;while),</span></div>
<div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;<span class="stringliteral">      ({ (#&#39;</span>&lt;),<span class="stringliteral">&#39;i,10 }),   // condition: i &lt; 10</span></div>
<div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;<span class="stringliteral">      42,                  // result is not interesting, but we must give one</span></div>
<div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;<span class="stringliteral">      ({ (#&#39;</span>write),<span class="stringliteral">&#39;i }),  // give out i</span></div>
<div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;<span class="stringliteral">      ({ (#&#39;</span>+=),<span class="stringliteral">&#39;i,1 })    // increase i</span></div>
<div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;<span class="stringliteral">    })</span></div>
<div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;<span class="stringliteral">  })</span></div>
<div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;<span class="stringliteral">)</span></div>
<div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;<span class="stringliteral"></span></div>
<div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;<span class="stringliteral">~~~</span></div>
<div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;<span class="stringliteral">The function this closure points to will give out the numbers from 0 to 9 and then return 42.</span></div>
<div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;<span class="stringliteral"></span></div>
<div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;<span class="stringliteral">`#&#39;</span><span class="keywordflow">do</span>`</div>
<div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;is like the <span class="keywordflow">do</span>-<span class="keywordflow">while</span> statement in LPC and is very much like the `#<span class="stringliteral">&#39;while`. The difference is that `#&#39;</span><span class="keywordflow">while</span>` tests the condition already before the body is evaluated <span class="keywordflow">for</span> the first time, <span class="keyword">this</span> means that the body might not be evaluated even once. `#<span class="stringliteral">&#39;do` evaluates the body first and then the condition, thus the body is evaluated at least one time.</span></div>
<div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;<span class="stringliteral"></span></div>
<div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;<span class="stringliteral">Furthermore, the arguments for `#&#39;</span><span class="keywordflow">do</span>` are changed in order. `#<span class="stringliteral">&#39;do` expects as first to last but two the body of the loop, then the condition (as last-but-one&#39;</span>th argument) and the result value as last argument. So `#<span class="stringliteral">&#39;do` must have at least two arguments: the condition and the result:</span></div>
<div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;<span class="stringliteral"></span></div>
<div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;<span class="stringliteral">~~~{.c}</span></div>
<div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;<span class="stringliteral">lambda(</span></div>
<div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;<span class="stringliteral">  0,</span></div>
<div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;<span class="stringliteral">  ({</span></div>
<div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;<span class="stringliteral">    (#&#39;</span>,),                 <span class="comment">// several things to do ...</span></div>
<div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;    ({ (#<span class="stringliteral">&#39;=),&#39;</span>i,0 }),      <span class="comment">// i is a local variable of this lambda-closure and is initialized with 0 now.</span></div>
<div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;    ({</div>
<div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;      (#<span class="stringliteral">&#39;do),</span></div>
<div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;<span class="stringliteral">      ({ (#&#39;</span>write),<span class="stringliteral">&#39;i }),  // give out i</span></div>
<div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;<span class="stringliteral">      ({ (#&#39;</span>+=),<span class="stringliteral">&#39;i,1 }),   // increase i</span></div>
<div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;<span class="stringliteral">      ({ (#&#39;</span>&lt;),<span class="stringliteral">&#39;i,10 }),   // condition: i &lt; 10</span></div>
<div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;<span class="stringliteral">      42                   // result is not interesting</span></div>
<div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;<span class="stringliteral">    })</span></div>
<div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;<span class="stringliteral">  })</span></div>
<div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;<span class="stringliteral">)</span></div>
<div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;<span class="stringliteral"></span></div>
<div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;<span class="stringliteral">~~~</span></div>
<div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;<span class="stringliteral">@par note: There is no `#&#39;</span><span class="keywordflow">for</span>` in LPC, you should use `#<span class="stringliteral">&#39;while` for this.</span></div>
<div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;<span class="stringliteral"></span></div>
<div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;<span class="stringliteral">`#&#39;</span><span class="keywordflow">foreach</span>`</div>
<div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;is like the @ref driver_syntax_foreach <span class="stringliteral">&quot;foreach&quot;</span> statement in LPC. It evaluates one or more bodies repeatedly <span class="keywordflow">for</span> every value in a giving <span class="keywordtype">string</span>, array or mapping. The result of the closure is 0.</div>
<div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;</div>
<div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;`#<span class="stringliteral">&#39;foreach` expects two or more arguments:</span></div>
<div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;<span class="stringliteral"></span></div>
<div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;<span class="stringliteral">- a single variable symbol, or an array with several variable symbols</span></div>
<div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;<span class="stringliteral">- the value to iterate over</span></div>
<div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;<span class="stringliteral">- zero or more bodes to evaluate in each iteration.</span></div>
<div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;<span class="stringliteral"></span></div>
<div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;<span class="stringliteral">The single values retrieved from the given value are assigned one after another to the variable(s), then the bodies are executed for each assignment:</span></div>
<div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;<span class="stringliteral"></span></div>
<div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;<span class="stringliteral">~~~{.c}</span></div>
<div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;<span class="stringliteral">lambda(</span></div>
<div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;<span class="stringliteral">  0,</span></div>
<div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;<span class="stringliteral">  ({</span></div>
<div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;<span class="stringliteral">    #&#39;</span><span class="keywordflow">foreach</span>,</div>
<div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;    <span class="stringliteral">&#39;o,</span></div>
<div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;<span class="stringliteral">    ({#&#39;</span>users}),</div>
<div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;    ({#<span class="stringliteral">&#39;call_other, &#39;</span>o, <span class="stringliteral">&quot;die&quot;</span> })</div>
<div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;  })</div>
<div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;);</div>
<div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;</div>
<div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;lambda(</div>
<div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;  0,</div>
<div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;  ({</div>
<div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;<span class="preprocessor">    #&#39;foreach,</span></div>
<div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;<span class="preprocessor"></span>    ({<span class="stringliteral">&#39;k, &#39;</span>v}),</div>
<div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;    ({ ...mapping...}),</div>
<div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;    ({#<span class="stringliteral">&#39;printf, &quot;%O:%O\n&quot;, &#39;</span>k, <span class="stringliteral">&#39;v })</span></div>
<div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;<span class="stringliteral">  })</span></div>
<div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;<span class="stringliteral">);</span></div>
<div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;<span class="stringliteral"></span></div>
<div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;<span class="stringliteral">~~~</span></div>
<div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;<span class="stringliteral"></span></div>
<div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;<span class="stringliteral">`#&#39;</span><span class="keywordflow">return</span>`</div>
<div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;gets one argument and acts like the <span class="stringliteral">&quot;return&quot;</span> statement in LPC in the <span class="keyword">function</span> that is created by <a class="code" href="classefun.html#a4ef2926c525dcf7e7d339d3f424b18a9">efun::lambda</a>(). It aborts the execution of <span class="keyword">this</span> <span class="keyword">function</span> and returns the argument:</div>
<div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;</div>
<div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;~~~{.c}</div>
<div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;lambda(</div>
<div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;  0,</div>
<div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;  ({</div>
<div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;    (#<span class="stringliteral">&#39;while),// loop</span></div>
<div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;<span class="stringliteral">    1,        // condition is 1 ==&gt; endles loop</span></div>
<div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;<span class="stringliteral">    42,       // return value (which will never be used)</span></div>
<div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;<span class="stringliteral">    ({ (#&#39;</span>write), <span class="stringliteral">&quot;grin&quot;</span> }),</div>
<div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;    ({</div>
<div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;      (#<span class="stringliteral">&#39;?!),                // ifnot</span></div>
<div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;<span class="stringliteral">      ({ (#&#39;</span>random), 10 }),  <span class="comment">//       (random(10))</span></div>
<div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;      ({ (#<span class="stringliteral">&#39;return), 100 })  //   return 100;</span></div>
<div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;<span class="stringliteral">    })</span></div>
<div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;<span class="stringliteral">  })</span></div>
<div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;<span class="stringliteral">)</span></div>
<div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;<span class="stringliteral"></span></div>
<div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;<span class="stringliteral">~~~</span></div>
<div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;<span class="stringliteral">This function will enter an endless loop that will in each turn give out &quot;grin&quot; and if `random(10)` returns 0 (which will of course happen very soon) it will leave the function with &quot;return 100&quot;. The value 42 that is given as result of the loop would be returned if the condition would evaluate to 0 which cannot be. (1 is never 0 ;-)</span></div>
<div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;<span class="stringliteral"></span></div>
<div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;<span class="stringliteral">`#&#39;</span><span class="keywordflow">break</span>`</div>
<div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;is used like the <span class="stringliteral">&quot;break&quot;</span> statement in LPC and aborts the execution of loops and switches. It must not appear outside a loop or <span class="keywordflow">switch</span> of the lambda closure itself, it cannot abort the execution of the <span class="keyword">function</span> the closure points to!:</div>
<div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;</div>
<div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;~~~{.c}</div>
<div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;lambda(</div>
<div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;  0,</div>
<div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;  ({</div>
<div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;    (#<span class="stringliteral">&#39;?),</span></div>
<div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;<span class="stringliteral">    ({ (#&#39;</span>random),2 }),</div>
<div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;    ({ (#<span class="stringliteral">&#39;break) }), // this will cause the error &quot;Unimplemented operator break for lambda()&quot;</span></div>
<div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;<span class="stringliteral">    &quot;random was false!&quot;</span></div>
<div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;<span class="stringliteral">  })</span></div>
<div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;<span class="stringliteral">);</span></div>
<div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;<span class="stringliteral"></span></div>
<div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;<span class="stringliteral">~~~</span></div>
<div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;<span class="stringliteral">You can use `({ #&#39;</span><span class="keywordflow">return</span>,0 })` instead of `({ #<span class="stringliteral">&#39;break })` in such cases.</span></div>
<div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;<span class="stringliteral"></span></div>
<div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;<span class="stringliteral">`#&#39;</span><span class="keywordflow">continue</span>`</div>
<div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;is used like the <span class="stringliteral">&quot;continue&quot;</span> statement in LPC and jumps to the end of the current loop and continues with the loop condition.</div>
<div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;</div>
<div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;`#<span class="stringliteral">&#39;default`</span></div>
<div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;<span class="stringliteral">may be used within a `#&#39;</span><span class="keywordflow">switch</span>-construct` but be careful! To call `symbol_function(<span class="stringliteral">&quot;default&quot;</span>)` (which is done usually by tools that allow closure-creation) might crash the driver! So please <span class="keywordflow">do</span> only use it within your LPC-files.</div>
<div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;</div>
<div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;@par note: This driver bug is fixed somewhere below @subpage driver_mailto:3.2.1@131 <span class="stringliteral">&quot;3.2.1@131&quot;</span>.</div>
<div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;</div>
<div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;`#<span class="stringliteral">&#39;..`</span></div>
<div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;<span class="stringliteral">may be used within a `#&#39;</span><span class="keywordflow">switch</span>-construct` but is not implemented yet (@subpage driver_mailto:3.2.1@131 <span class="stringliteral">&quot;3.2.1@131&quot;</span>). But `#<span class="stringliteral">&#39;[..]` works well instead of it.</span></div>
<div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;<span class="stringliteral"></span></div>
<div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;<span class="stringliteral">`#&#39;</span><span class="keywordflow">switch</span>`</div>
<div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;is used to create closures which behave very much like the <span class="keywordflow">switch</span>-construct in LPC. To understand the following you should already know the syntax and possibilities of the latter one (which is mightier than the C-version of <span class="keywordflow">switch</span>).</div>
<div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;</div>
<div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;I will confront some LPC versions and the corresponding closure versions below.</div>
<div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;</div>
<div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;~~~{.c}</div>
<div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;LPC:                  Closure::</div>
<div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;</div>
<div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;switch (x) {                    lambda(0,({ (#<span class="stringliteral">&#39;switch), x,</span></div>
<div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;<span class="stringliteral">case 5:                           ({ 5 }),</span></div>
<div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;<span class="stringliteral"> return &quot;five&quot;;                  ({ (#&#39;</span><span class="keywordflow">return</span>),<span class="stringliteral">&quot;five&quot;</span> }),</div>
<div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;                                 (#<span class="stringliteral">&#39;,),</span></div>
<div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;<span class="stringliteral">case 6..9:                        ({ 6, (#&#39;</span>[..]), 9 }),</div>
<div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160; <span class="keywordflow">return</span> <span class="stringliteral">&quot;six to nine&quot;</span>;           ({ (#<span class="stringliteral">&#39;return),</span></div>
<div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;<span class="stringliteral">                                    &quot;six to nine&quot; }),</span></div>
<div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;<span class="stringliteral">                                 (#&#39;</span>,),</div>
<div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;<span class="keywordflow">case</span> 1:                           ({ 1 }),</div>
<div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160; write(<span class="stringliteral">&quot;one&quot;</span>);                   ({ (#<span class="stringliteral">&#39;write),&quot;one&quot; }),</span></div>
<div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;<span class="stringliteral"> // fall through                 (#&#39;</span>,),</div>
<div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;<span class="keywordflow">case</span> 2:                           ({ 2,</div>
<div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;<span class="keywordflow">case</span> 10:                             10 }),</div>
<div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160; <span class="keywordflow">return</span> <span class="stringliteral">&quot;two or ten&quot;</span>;            ({ (#<span class="stringliteral">&#39;return),</span></div>
<div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;<span class="stringliteral">                                    &quot;two or ten&quot; }),</span></div>
<div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;<span class="stringliteral">                                 (#&#39;</span>,),</div>
<div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;<span class="keywordflow">case</span> 3..4:                        ({ 3, (#<span class="stringliteral">&#39;[..]), 4 }),</span></div>
<div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;<span class="stringliteral"> write(&quot;three to four&quot;);         ({ (#&#39;</span>write),</div>
<div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;                                    <span class="stringliteral">&quot;three to four&quot;</span> }),</div>
<div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160; <span class="keywordflow">break</span>;  <span class="comment">// leave switch         (#&#39;break),</span></div>
<div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;<span class="keywordflow">default</span>:                          ({ (#<span class="stringliteral">&#39;default) }),</span></div>
<div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;<span class="stringliteral"> write(&quot;something else&quot;);        ({ (#&#39;</span>write),</div>
<div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;                                    <span class="stringliteral">&quot;something else&quot;</span> }),</div>
<div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160; <span class="keywordflow">break</span>;                          (#<span class="stringliteral">&#39;break)</span></div>
<div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;<span class="stringliteral">}                              }))</span></div>
<div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;<span class="stringliteral"></span></div>
<div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;<span class="stringliteral">~~~</span></div>
<div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;<span class="stringliteral"></span></div>
<div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;<span class="stringliteral">`#&#39;</span>&amp;&amp;`</div>
<div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;evaluates the arguments from the first on and stops <span class="keywordflow">if</span> one evaluates to 0 and returns 0. If none evaluates to 0 it returns the result of the last argument.</div>
<div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;</div>
<div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;`#<span class="stringliteral">&#39;||`</span></div>
<div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;<span class="stringliteral">evaluates the arguments from the first on and stops if one evaluates to true (not 0) and returns it. If all evaluate to 0 it returns 0.</span></div>
<div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;<span class="stringliteral"></span></div>
<div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;<span class="stringliteral">`#&#39;</span><span class="keywordflow">catch</span>`</div>
<div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;executes the closure given as argument, but catches any runtime error (see <a class="code" href="classefun.html#ae5c7019db4983c1c09bbf9ebe1b93869">efun::catch</a>()). Optionally the symbols <span class="stringliteral">&#39;nolog, &#39;</span>publish and <span class="stringliteral">&#39;reserve may be given as additional arguments to modify the behaviour of the catch.</span></div>
<div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;<span class="stringliteral"></span></div>
<div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;<span class="stringliteral">`#&#39;</span>sscanf`</div>
<div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;acts similar to how a funcall would, but passes the third and following arguments as lvalues, that is, values which can be assigned to.</div>
<div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;</div>
<div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;`#<span class="stringliteral">&#39;=` and the `#&#39;</span>&lt;op&gt;=` variants</div>
<div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;are also special because the first argument has to be an lvalue.</div>
<div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;</div>
<div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;## Closures with Strange Names #</div>
<div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;</div>
<div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;`#<span class="stringliteral">&#39;negate`</span></div>
<div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;<span class="stringliteral">is the unary minus that returns -x for the argument x.:</span></div>
<div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;<span class="stringliteral"></span></div>
<div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;<span class="stringliteral">~~~{.c}</span></div>
<div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;<span class="stringliteral">map(({ 1,2,3 }), #&#39;</span>negate) <span class="comment">// returns ({ -1,-2,-3 })</span></div>
<div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;</div>
<div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;~~~</div>
<div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;</div>
<div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;`#<span class="stringliteral">&#39;[`</span></div>
<div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;<span class="stringliteral">is used for the things that in LPC are done with the @ref driver_syntax_index &quot;[]&quot; (it indexes an array or a mapping):</span></div>
<div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;<span class="stringliteral"></span></div>
<div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;<span class="stringliteral">~~~{.c}</span></div>
<div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;<span class="stringliteral">lambda(0, ({ #&#39;</span>[, quote(({ 10, 50, 30, 70 })), 2 })) ==&gt; 30</div>
<div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160;lambda(0, ({ #<span class="stringliteral">&#39;[, ([ &quot;x&quot;:10;50, &quot;y&quot;:30;70 ]), &quot;x&quot;, 1 })) ==&gt; 50</span></div>
<div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;<span class="stringliteral"></span></div>
<div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;<span class="stringliteral">~~~</span></div>
<div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;<span class="stringliteral"></span></div>
<div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;<span class="stringliteral">`#&#39;</span>[&lt;`</div>
<div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;is the same as `#<span class="stringliteral">&#39;[` but counts the elements from the end (like indexing with `[]` and the `&lt;`).</span></div>
<div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;<span class="stringliteral"></span></div>
<div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;<span class="stringliteral">`#&#39;</span>[..]`</div>
<div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;returns a subarray of the argument from the one given index to the other given index, both counted from the beginning of the array.</div>
<div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;</div>
<div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;`#<span class="stringliteral">&#39;[..&lt;]`</span></div>
<div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;<span class="stringliteral">`#&#39;</span>[&lt;..]`</div>
<div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;`#<span class="stringliteral">&#39;[&lt;..&lt;]`</span></div>
<div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;<span class="stringliteral">same as above, but the indexes are counted from the end:</span></div>
<div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160;<span class="stringliteral"></span></div>
<div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160;<span class="stringliteral">~~~{.c}</span></div>
<div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;<span class="stringliteral">lambda(</span></div>
<div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;<span class="stringliteral">  0,</span></div>
<div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;<span class="stringliteral">  ({</span></div>
<div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;<span class="stringliteral">    #&#39;</span>[..&lt;],</div>
<div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;    quote(({ 0,1,2,3,4,5,6,7 })),</div>
<div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160;    2,</div>
<div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160;    3</div>
<div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160;  })</div>
<div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160;)</div>
<div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160;</div>
<div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160;~~~</div>
<div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;This will <span class="keywordflow">return</span> `({ 2,3,4,5 })`.</div>
<div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160;</div>
<div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;`#<span class="stringliteral">&#39;[..`</span></div>
<div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160;<span class="stringliteral">`#&#39;</span>[&lt;..`</div>
<div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;same as above, but only the first index is given, the subarray will go till the end of the original (like with `[x..]`).</div>
<div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160;</div>
<div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160;`#<span class="stringliteral">&#39;({`</span></div>
<div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;<span class="stringliteral">is used to create arrays (as with `({ })` in LPC). All arguments become the elements of the array.:</span></div>
<div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;<span class="stringliteral"></span></div>
<div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160;<span class="stringliteral">~~~{.c}</span></div>
<div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160;<span class="stringliteral">lambda(</span></div>
<div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160;<span class="stringliteral">  0,</span></div>
<div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160;<span class="stringliteral">  ({</span></div>
<div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160;<span class="stringliteral">    #&#39;</span>({,</div>
<div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160;    ({ (#<span class="stringliteral">&#39;random), 10 }),</span></div>
<div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160;<span class="stringliteral">    ({ (#&#39;</span>random), 50 }),</div>
<div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160;    ({ (#<span class="stringliteral">&#39;random), 30 }),</span></div>
<div class="line"><a name="l00529"></a><span class="lineno">  529</span>&#160;<span class="stringliteral">    ({ (#&#39;</span>random), 70 })</div>
<div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160;  })</div>
<div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160;)</div>
<div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160;</div>
<div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160;~~~</div>
<div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160;This returns `({ random(10), random(50), random(30), random(70) })`.</div>
<div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160;</div>
<div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160;`#<span class="stringliteral">&#39;([`</span></div>
<div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160;<span class="stringliteral">is used to create mappings out of single entries (with several values) like the `([ ])` in LPC. Very unusual is the fact that this closure gets arrays as argument that are not evaluated, although they are not quoted.:</span></div>
<div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160;<span class="stringliteral"></span></div>
<div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160;<span class="stringliteral">~~~{.c}</span></div>
<div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160;<span class="stringliteral">lambda(</span></div>
<div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160;<span class="stringliteral">  0,</span></div>
<div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160;<span class="stringliteral">  ({</span></div>
<div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160;<span class="stringliteral">    #&#39;</span>([,</div>
<div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160;    ({ <span class="stringliteral">&quot;x&quot;</span>,1,2,3 }),</div>
<div class="line"><a name="l00545"></a><span class="lineno">  545</span>&#160;    ({ <span class="stringliteral">&quot;y&quot;</span>,4,5,6 })</div>
<div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160;  })</div>
<div class="line"><a name="l00547"></a><span class="lineno">  547</span>&#160;);</div>
<div class="line"><a name="l00548"></a><span class="lineno">  548</span>&#160;</div>
<div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160;~~~</div>
<div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160;This returns `([ <span class="stringliteral">&quot;x&quot;</span>: 1;2;3, <span class="stringliteral">&quot;y&quot;</span>: 4;5;6 ])`.</div>
<div class="line"><a name="l00551"></a><span class="lineno">  551</span>&#160;</div>
<div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160;However, the elements of the arrays are evaluated as lambda expressions, so <span class="keywordflow">if</span> you want to create a mapping from values evaluated at call time, write them as lambda closures:</div>
<div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160;</div>
<div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160;~~~{.c}</div>
<div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160;lambda(0, ({ #<span class="stringliteral">&#39;([, ({ 1, ({ #&#39;</span>ctime }) }) }) )</div>
<div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160;</div>
<div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160;~~~</div>
<div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160;will <span class="keywordflow">return</span> `([ 1: &lt;result of ctime() at call time&gt; ])`.</div>
<div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160;</div>
<div class="line"><a name="l00560"></a><span class="lineno">  560</span>&#160;Arrays can be put into the mapping by quoting:</div>
<div class="line"><a name="l00561"></a><span class="lineno">  561</span>&#160;</div>
<div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160;~~~{.c}</div>
<div class="line"><a name="l00563"></a><span class="lineno">  563</span>&#160;lambda(0, ({ #<span class="stringliteral">&#39;([, ({ 1, &#39;</span>({ 2 }) }) }) )</div>
<div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160;</div>
<div class="line"><a name="l00565"></a><span class="lineno">  565</span>&#160;~~~</div>
<div class="line"><a name="l00566"></a><span class="lineno">  566</span>&#160;will <span class="keywordflow">return</span> `([ 1: ({ 2 }) ])`</div>
<div class="line"><a name="l00567"></a><span class="lineno">  567</span>&#160;</div>
<div class="line"><a name="l00568"></a><span class="lineno">  568</span>&#160;`#<span class="stringliteral">&#39;[,]`</span></div>
<div class="line"><a name="l00569"></a><span class="lineno">  569</span>&#160;<span class="stringliteral">is nearly the same as `#&#39;</span>[`. The only difference shows up <span class="keywordflow">if</span> you want to index a mapping with a width greater than 1 (with more than just one value per key) directly with <a class="code" href="classefun.html#a665f686219e1bffdb5e89a5158167473">efun::funcall</a>(). Example:</div>
<div class="line"><a name="l00570"></a><span class="lineno">  570</span>&#160;</div>
<div class="line"><a name="l00571"></a><span class="lineno">  571</span>&#160;~~~{.c}</div>
<div class="line"><a name="l00572"></a><span class="lineno">  572</span>&#160;funcall(#<span class="stringliteral">&#39;[,([ 0:1;2, 3:4;5 ]),0,1)</span></div>
<div class="line"><a name="l00573"></a><span class="lineno">  573</span>&#160;<span class="stringliteral"></span></div>
<div class="line"><a name="l00574"></a><span class="lineno">  574</span>&#160;<span class="stringliteral">~~~</span></div>
<div class="line"><a name="l00575"></a><span class="lineno">  575</span>&#160;<span class="stringliteral">This will not work. Use `#&#39;</span>[,]` and it will work. If you want to use it in a lambda closure you <span class="keywordflow">do</span> not have to use `#<span class="stringliteral">&#39;[,]` and `#&#39;</span>[` will <span class="keywordflow">do</span> fine. On the other hand, `#<span class="stringliteral">&#39;[,]` cannot work with arrays, so in nearly all cases use `#&#39;</span>[` and just in the described special <span class="keywordflow">case</span>, use `#<span class="stringliteral">&#39;[,]`. This is a strange thing and I deem it a bug, so it might change in the future.</span></div>
<div class="line"><a name="l00576"></a><span class="lineno">  576</span>&#160;<span class="stringliteral"></span></div>
<div class="line"><a name="l00577"></a><span class="lineno">  577</span>&#160;<span class="stringliteral">## Operator-Closures #</span></div>
<div class="line"><a name="l00578"></a><span class="lineno">  578</span>&#160;<span class="stringliteral"></span></div>
<div class="line"><a name="l00579"></a><span class="lineno">  579</span>&#160;<span class="stringliteral">Most of the closures that are used for things which are done by operators are in fact not operator-closures but efun-closures. But there are a few which do not have the state of efun-closures but are called &quot;operator-closures&quot;. `#&#39;</span><span class="keywordflow">return</span>` is an example, a complete list of them is given below.</div>
<div class="line"><a name="l00580"></a><span class="lineno">  580</span>&#160;</div>
<div class="line"><a name="l00581"></a><span class="lineno">  581</span>&#160;These closures cannot be called directly <span class="keyword">using</span> <a class="code" href="classefun.html#a665f686219e1bffdb5e89a5158167473">efun::funcall</a>() or <a class="code" href="classefun.html#aaf018e933ee843dfe67f2916aeeb51a1">efun::apply</a>() (or other efuns like <a class="code" href="classefun.html#ac5e7282ed029a438608ee96f18052e33">efun::filter</a>()), but must appear only in lambda-constructs.</div>
<div class="line"><a name="l00582"></a><span class="lineno">  582</span>&#160;</div>
<div class="line"><a name="l00583"></a><span class="lineno">  583</span>&#160;~~~{.c}</div>
<div class="line"><a name="l00584"></a><span class="lineno">  584</span>&#160;funcall(#<span class="stringliteral">&#39;return,4);  // does not work! This will raise an Uncallable-closure error.</span></div>
<div class="line"><a name="l00585"></a><span class="lineno">  585</span>&#160;<span class="stringliteral">funcall(lambda(0, ({ (#&#39;</span><span class="keywordflow">return</span>),4 }) ));   <span class="comment">// this is a correct example</span></div>
<div class="line"><a name="l00586"></a><span class="lineno">  586</span>&#160;</div>
<div class="line"><a name="l00587"></a><span class="lineno">  587</span>&#160;~~~</div>
<div class="line"><a name="l00588"></a><span class="lineno">  588</span>&#160;All <span class="keyword">operator</span>-closures:</div>
<div class="line"><a name="l00589"></a><span class="lineno">  589</span>&#160;</div>
<div class="line"><a name="l00590"></a><span class="lineno">  590</span>&#160;~~~{.c}</div>
<div class="line"><a name="l00591"></a><span class="lineno">  591</span>&#160;<span class="preprocessor">#&#39;&amp;&amp;</span></div>
<div class="line"><a name="l00592"></a><span class="lineno">  592</span>&#160;<span class="preprocessor"></span><span class="preprocessor">#&#39;||</span></div>
<div class="line"><a name="l00593"></a><span class="lineno">  593</span>&#160;<span class="preprocessor"></span><span class="preprocessor">#&#39;,</span></div>
<div class="line"><a name="l00594"></a><span class="lineno">  594</span>&#160;<span class="preprocessor"></span><span class="preprocessor">#&#39;?</span></div>
<div class="line"><a name="l00595"></a><span class="lineno">  595</span>&#160;<span class="preprocessor"></span><span class="preprocessor">#&#39;?!</span></div>
<div class="line"><a name="l00596"></a><span class="lineno">  596</span>&#160;<span class="preprocessor"></span><span class="preprocessor">#&#39;=</span></div>
<div class="line"><a name="l00597"></a><span class="lineno">  597</span>&#160;<span class="preprocessor"></span><span class="preprocessor">#&#39;&lt;op&gt;=</span></div>
<div class="line"><a name="l00598"></a><span class="lineno">  598</span>&#160;<span class="preprocessor"></span><span class="preprocessor">#&#39;++</span></div>
<div class="line"><a name="l00599"></a><span class="lineno">  599</span>&#160;<span class="preprocessor"></span><span class="preprocessor">#&#39;--</span></div>
<div class="line"><a name="l00600"></a><span class="lineno">  600</span>&#160;<span class="preprocessor"></span><span class="preprocessor">#&#39;break</span></div>
<div class="line"><a name="l00601"></a><span class="lineno">  601</span>&#160;<span class="preprocessor"></span><span class="preprocessor">#&#39;catch</span></div>
<div class="line"><a name="l00602"></a><span class="lineno">  602</span>&#160;<span class="preprocessor"></span><span class="preprocessor">#&#39;continue</span></div>
<div class="line"><a name="l00603"></a><span class="lineno">  603</span>&#160;<span class="preprocessor"></span><span class="preprocessor">#&#39;default</span></div>
<div class="line"><a name="l00604"></a><span class="lineno">  604</span>&#160;<span class="preprocessor"></span><span class="preprocessor">#&#39;do</span></div>
<div class="line"><a name="l00605"></a><span class="lineno">  605</span>&#160;<span class="preprocessor"></span><span class="preprocessor">#&#39;foreach</span></div>
<div class="line"><a name="l00606"></a><span class="lineno">  606</span>&#160;<span class="preprocessor"></span><span class="preprocessor">#&#39;return</span></div>
<div class="line"><a name="l00607"></a><span class="lineno">  607</span>&#160;<span class="preprocessor"></span><span class="preprocessor">#&#39;sscanf</span></div>
<div class="line"><a name="l00608"></a><span class="lineno">  608</span>&#160;<span class="preprocessor"></span><span class="preprocessor">#&#39;switch</span></div>
<div class="line"><a name="l00609"></a><span class="lineno">  609</span>&#160;<span class="preprocessor"></span><span class="preprocessor">#&#39;while</span></div>
<div class="line"><a name="l00610"></a><span class="lineno">  610</span>&#160;<span class="preprocessor"></span><span class="preprocessor">#&#39;({</span></div>
<div class="line"><a name="l00611"></a><span class="lineno">  611</span>&#160;<span class="preprocessor"></span><span class="preprocessor">#&#39;([</span></div>
<div class="line"><a name="l00612"></a><span class="lineno">  612</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l00613"></a><span class="lineno">  613</span>&#160;~~~</div>
<div class="line"><a name="l00614"></a><span class="lineno">  614</span>&#160;`#<span class="stringliteral">&#39;..` is very likely to be an operator closure too, but since it is not implemented yet, I cannot say for sure.</span></div>
<div class="line"><a name="l00615"></a><span class="lineno">  615</span>&#160;<span class="stringliteral"></span></div>
<div class="line"><a name="l00616"></a><span class="lineno">  616</span>&#160;<span class="stringliteral">## Variable-Closures #</span></div>
<div class="line"><a name="l00617"></a><span class="lineno">  617</span>&#160;<span class="stringliteral"></span></div>
<div class="line"><a name="l00618"></a><span class="lineno">  618</span>&#160;<span class="stringliteral">All object-global variables might be &quot;closured&quot; by prepending a `#&#39;</span>` to them to allow access and/or manipulation of them. So <span class="keywordflow">if</span> your <span class="keywordtype">object</span> has a global variable x you can use `#<span class="stringliteral">&#39;x` within a closure.</span></div>
<div class="line"><a name="l00619"></a><span class="lineno">  619</span>&#160;<span class="stringliteral"></span></div>
<div class="line"><a name="l00620"></a><span class="lineno">  620</span>&#160;<span class="stringliteral">Normally you will treat those expressions like lfun-closures: put them into an array to get the value:</span></div>
<div class="line"><a name="l00621"></a><span class="lineno">  621</span>&#160;<span class="stringliteral"></span></div>
<div class="line"><a name="l00622"></a><span class="lineno">  622</span>&#160;<span class="stringliteral">Anybody who now calls `object-&gt;foo()` will get a closure which will, when evaluated, write the actual value of object&#39;</span>s global variable x.</div>
<div class="line"><a name="l00623"></a><span class="lineno">  623</span>&#160;</div>
<div class="line"><a name="l00624"></a><span class="lineno">  624</span>&#160;Variable closures <span class="keywordflow">do</span> not accept arguments.</div>
<div class="line"><a name="l00625"></a><span class="lineno">  625</span>&#160;</div>
<div class="line"><a name="l00626"></a><span class="lineno">  626</span>&#160;# Examples #</div>
<div class="line"><a name="l00627"></a><span class="lineno">  627</span>&#160;</div>
<div class="line"><a name="l00628"></a><span class="lineno">  628</span>&#160;In <span class="keyword">this</span> section I will give and explain some examples coming out of praxis. If the explanation seems to be in some cases too detailed <span class="keyword">this</span> can be explained by the trial to allow the reader to read the examples section first ;-)</div>
<div class="line"><a name="l00629"></a><span class="lineno">  629</span>&#160;</div>
<div class="line"><a name="l00630"></a><span class="lineno">  630</span>&#160;## Lfun-Closure #</div>
<div class="line"><a name="l00631"></a><span class="lineno">  631</span>&#160;</div>
<div class="line"><a name="l00632"></a><span class="lineno">  632</span>&#160;An item with a complex <span class="keywordtype">long</span>-description like a watch that shall always show the actual time will usually base upon the complex/item-<span class="keyword">class</span> and give an lfun-closure as argument to the `set_long()` method.</div>
<div class="line"><a name="l00633"></a><span class="lineno">  633</span>&#160;</div>
<div class="line"><a name="l00634"></a><span class="lineno">  634</span>&#160;_watch.c_:</div>
<div class="line"><a name="l00635"></a><span class="lineno">  635</span>&#160;</div>
<div class="line"><a name="l00636"></a><span class="lineno">  636</span>&#160;~~~{.c}</div>
<div class="line"><a name="l00637"></a><span class="lineno">  637</span>&#160;inherit <span class="stringliteral">&quot;complex/item&quot;</span>;</div>
<div class="line"><a name="l00638"></a><span class="lineno">  638</span>&#160;</div>
<div class="line"><a name="l00639"></a><span class="lineno">  639</span>&#160;<span class="keywordtype">string</span> my_long() {</div>
<div class="line"><a name="l00640"></a><span class="lineno">  640</span>&#160;  <span class="keywordflow">return</span> (<span class="stringliteral">&quot;The watch is small and has a strange otherworldly&quot;</span></div>
<div class="line"><a name="l00641"></a><span class="lineno">  641</span>&#160;    <span class="stringliteral">&quot; aura about it.\n&quot;</span></div>
<div class="line"><a name="l00642"></a><span class="lineno">  642</span>&#160;    <span class="stringliteral">&quot;The current time is: &quot;</span>+ctime()+<span class="stringliteral">&quot;.\n&quot;</span>);</div>
<div class="line"><a name="l00643"></a><span class="lineno">  643</span>&#160;}</div>
<div class="line"><a name="l00644"></a><span class="lineno">  644</span>&#160;</div>
<div class="line"><a name="l00645"></a><span class="lineno">  645</span>&#160;<span class="keywordtype">void</span> create() {</div>
<div class="line"><a name="l00646"></a><span class="lineno">  646</span>&#160;  set_short(<span class="stringliteral">&quot;a little watch&quot;</span>);</div>
<div class="line"><a name="l00647"></a><span class="lineno">  647</span>&#160;  set_id(({ <span class="stringliteral">&quot;watch&quot;</span>,<span class="stringliteral">&quot;little watch&quot;</span> }));</div>
<div class="line"><a name="l00648"></a><span class="lineno">  648</span>&#160;  set_long(#<span class="stringliteral">&#39;my_long);  // the lfun-closure to the lfun my_long()</span></div>
<div class="line"><a name="l00649"></a><span class="lineno">  649</span>&#160;<span class="stringliteral">}</span></div>
<div class="line"><a name="l00650"></a><span class="lineno">  650</span>&#160;<span class="stringliteral"></span></div>
<div class="line"><a name="l00651"></a><span class="lineno">  651</span>&#160;<span class="stringliteral">~~~</span></div>
<div class="line"><a name="l00652"></a><span class="lineno">  652</span>&#160;<span class="stringliteral"></span></div>
<div class="line"><a name="l00653"></a><span class="lineno">  653</span>&#160;<span class="stringliteral">## Lambda-Closure #</span></div>
<div class="line"><a name="l00654"></a><span class="lineno">  654</span>&#160;<span class="stringliteral"></span></div>
<div class="line"><a name="l00655"></a><span class="lineno">  655</span>&#160;<span class="stringliteral">The example from 3.1 can also be written using a lambda-closure.</span></div>
<div class="line"><a name="l00656"></a><span class="lineno">  656</span>&#160;<span class="stringliteral"></span></div>
<div class="line"><a name="l00657"></a><span class="lineno">  657</span>&#160;<span class="stringliteral">_watch-lambda.c_:</span></div>
<div class="line"><a name="l00658"></a><span class="lineno">  658</span>&#160;<span class="stringliteral"></span></div>
<div class="line"><a name="l00659"></a><span class="lineno">  659</span>&#160;<span class="stringliteral">~~~{.c}</span></div>
<div class="line"><a name="l00660"></a><span class="lineno">  660</span>&#160;<span class="stringliteral">inherit &quot;complex/item&quot;;</span></div>
<div class="line"><a name="l00661"></a><span class="lineno">  661</span>&#160;<span class="stringliteral"></span></div>
<div class="line"><a name="l00662"></a><span class="lineno">  662</span>&#160;<span class="stringliteral">void create() {</span></div>
<div class="line"><a name="l00663"></a><span class="lineno">  663</span>&#160;<span class="stringliteral">  set_short(&quot;a little watch&quot;);</span></div>
<div class="line"><a name="l00664"></a><span class="lineno">  664</span>&#160;<span class="stringliteral">  set_id(({ &quot;watch&quot;,&quot;little watch&quot; }));</span></div>
<div class="line"><a name="l00665"></a><span class="lineno">  665</span>&#160;<span class="stringliteral">  set_long(lambda(</span></div>
<div class="line"><a name="l00666"></a><span class="lineno">  666</span>&#160;<span class="stringliteral">    0,</span></div>
<div class="line"><a name="l00667"></a><span class="lineno">  667</span>&#160;<span class="stringliteral">    ({</span></div>
<div class="line"><a name="l00668"></a><span class="lineno">  668</span>&#160;<span class="stringliteral">      (#&#39;</span>+),</div>
<div class="line"><a name="l00669"></a><span class="lineno">  669</span>&#160;      <span class="stringliteral">&quot;The watch is small and has a strange&quot;</span></div>
<div class="line"><a name="l00670"></a><span class="lineno">  670</span>&#160;      <span class="stringliteral">&quot; otherworldly aura about it.\n&quot;</span></div>
<div class="line"><a name="l00671"></a><span class="lineno">  671</span>&#160;      <span class="stringliteral">&quot;The current time is: &quot;</span>,</div>
<div class="line"><a name="l00672"></a><span class="lineno">  672</span>&#160;      ({</div>
<div class="line"><a name="l00673"></a><span class="lineno">  673</span>&#160;        (#<span class="stringliteral">&#39;+),</span></div>
<div class="line"><a name="l00674"></a><span class="lineno">  674</span>&#160;<span class="stringliteral">        ({ (#&#39;</span>ctime) }),</div>
<div class="line"><a name="l00675"></a><span class="lineno">  675</span>&#160;        <span class="stringliteral">&quot;.\n&quot;</span></div>
<div class="line"><a name="l00676"></a><span class="lineno">  676</span>&#160;      })</div>
<div class="line"><a name="l00677"></a><span class="lineno">  677</span>&#160;    })</div>
<div class="line"><a name="l00678"></a><span class="lineno">  678</span>&#160;  ));</div>
<div class="line"><a name="l00679"></a><span class="lineno">  679</span>&#160;}</div>
<div class="line"><a name="l00680"></a><span class="lineno">  680</span>&#160;</div>
<div class="line"><a name="l00681"></a><span class="lineno">  681</span>&#160;~~~</div>
<div class="ttc" id="classefun_html_ac5e7282ed029a438608ee96f18052e33"><div class="ttname"><a href="classefun.html#ac5e7282ed029a438608ee96f18052e33">efun.filter</a></div><div class="ttdeci">mapping filter(mapping arg, closure cl, mixed extra...)</div><div class="ttdoc">Call the function &lt;ob&gt;-&gt;&lt;func&gt;() resp. </div></div>
<div class="ttc" id="classefun_html_aaf018e933ee843dfe67f2916aeeb51a1"><div class="ttname"><a href="classefun.html#aaf018e933ee843dfe67f2916aeeb51a1">efun.apply</a></div><div class="ttdeci">mixed apply(closure cl,...)</div><div class="ttdoc">Evaluates the closure cl with the following arguments. </div></div>
<div class="ttc" id="classefun_html_a665f686219e1bffdb5e89a5158167473"><div class="ttname"><a href="classefun.html#a665f686219e1bffdb5e89a5158167473">efun.funcall</a></div><div class="ttdeci">mixed funcall(closure cl, mixed arg ...)</div><div class="ttdoc">Evaluates the closure. </div></div>
<div class="ttc" id="classefun_html_a6f70cb143146d31cee7c413d2f0a0b9a"><div class="ttname"><a href="classefun.html#a6f70cb143146d31cee7c413d2f0a0b9a">efun.symbol_function</a></div><div class="ttdeci">closure symbol_function(string arg, object|string ob)</div><div class="ttdoc">Constructs a lfun closure, efun closure, or operator closure from the first arg (string or symbol)...</div></div>
<div class="ttc" id="classefun_html_afacd7cdaff7309a4b579f4c14db53662"><div class="ttname"><a href="classefun.html#afacd7cdaff7309a4b579f4c14db53662">efun.write</a></div><div class="ttdeci">void write(mixed msg)</div><div class="ttdoc">Write out something to the current user. </div></div>
<div class="ttc" id="classefun_html_a4ef2926c525dcf7e7d339d3f424b18a9"><div class="ttname"><a href="classefun.html#a4ef2926c525dcf7e7d339d3f424b18a9">efun.lambda</a></div><div class="ttdeci">closure lambda(mixed  *arr, mixed)</div><div class="ttdoc">Constructs a lambda closure, like lambda function in LISP. </div></div>
<div class="ttc" id="classefun_html"><div class="ttname"><a href="classefun.html">efun</a></div><div class="ttdef"><b>Definition:</b> <a href="abs_8c_source.html#l00001">abs.c:1</a></div></div>
<div class="ttc" id="classefun_html_ae5c7019db4983c1c09bbf9ebe1b93869"><div class="ttname"><a href="classefun.html#ae5c7019db4983c1c09bbf9ebe1b93869">efun.catch</a></div><div class="ttdeci">mixed catch(expr, expr,...; modifiers)</div><div class="ttdoc">Evaluate the expressions. </div></div>
</div><!-- fragment --></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><b>closure_guide.md</b></li>
    <li class="footer">Generated on Thu Mar 9 2017 17:45:23 for LDMud by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.6 </li>
  </ul>
</div>
</body>
</html>
