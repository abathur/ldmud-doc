<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.6"/>
<title>Tsunami: native</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">Tsunami
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.6 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('driver_concepts_native.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">native </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>During the evolution of LPMud there has been a hiatus as the old driver became too restricting for the demands of modern muds: it did a lot of things the mudlib could do better or completely different. Removing these things from the driver weren't a problem, but to keep compatible with the existing mudlibs (namely the well-known 2.4.5 lib), it was possible to undo these changes. First by setting a runtime option, then by compiling the driver either in 'compat' or in 'native' mode.</p>
<p>Starting with 3.2.1, the distinction between compat and native mode is more and more transferred into the mudlib, with the future goal of having a modeless driver.</p>
<p>Starting with 3.2.7, native mode no longer exists as such, only 'plain' (quasi a superset of 'native' and 'compat') and 'compat' mode, and since 3.2.9 the mode selection can be made via commandline option.</p>
<p>The main mode of the driver is determined at compile time by preprocessor symbols to be defined/undefined in config.h:</p>
<p>COMPAT_MODE: when defined, the compat mode specifics are activated by default.</p>
<p>Additional modifications can be achieved by the specification of commandline arguments (most of them have a default setting entry in config.h as well):</p>
<p>strict-euids: when active, euid usage is enforced. compat: when active, the compat mode is used.</p>
<p>Following is the description of the changes (de) activated by these defines. A shorthand notation is used: 'compat' means 'if compat mode is active' and '!compat' means 'if compat mode is not active', etc.</p>
<p>Predefined Preprocessor Symbols If compat, the symbols COMPAT_FLAG and <b>COMPAT_MODE</b> are defined for all LPC programs. If strict-euids, the symbol <b>STRICT_EUIDS</b> is defined for all LPC programs. For compatibility reasons, the symbol <b>EUIDS</b> is defined for all LPC programs all the time.</p>
<p>Preloading Of Objects The driver has the possibility to preload objects before the game is actually opened to the world. This is done by calling master-&gt;epilog(), which has to return 0 or an array. If its an array, its elements (as long as they are strings) are given one by one as argument to master-&gt;preload() which may now preload the objects (or do anything else).</p>
<p>Initialisation Of Objects It is task of the mudlib (through the driver hooks) to call the initialisation lfuns in newly created objects. The following table shows the traditional calls:</p>
<div class="fragment"><div class="line">       mode        : init call : reset call</div>
<div class="line">--------------------------------------------</div>
<div class="line"> !compat &amp; !native :  create() :  reset(1)</div>
<div class="line"> !compat &amp;  native :  create() :  reset()</div>
<div class="line">  compat &amp; !native :  reset(0) :  reset(1)</div>
<div class="line">  compat &amp;  native :  reset(0) :  reset(1)</div>
</div><!-- fragment --><p> If INITIALIZATION_BY___INIT was defined, the lfun __INIT() is called first on creation to initialize the objects variables.</p>
<p>Movement Of Objects The efun move_object() is implemented in the mudlib through driver hooks and the set_environment() efun. move_object() itself exists just for convenience and compatibility.</p>
<p>In original native mode, move_object() could applied only to this_object() as the object to move, and it called the lfun exit() in the old environment if in compat mode. As a side effect, the lfun exit() may not be target of add_action()s in compat mode.</p>
<p>In compat mode, objects may be moved using the transfer() efun. It does make assumptions about the design of the mudlib, though, as it calls the lfuns query_weight(), can_put_and_get(), get(), prevent_insert() and add_weight().</p>
<p>Efuns In General creator(), transfer() These exist only in compat mode (creator() is identical with getuid()).</p>
<p>object_name(), function_exists() In !compat mode, the returned filenames start with a leading '/', in compat mode they don't.</p>
<p>parse_command() This command exists in two versions: the old is used with compat, the new with !compat. However, SUPPLY_PARSE_COMMAND must be defined in config.h in both cases (this efun is not very useful at all).</p>
<p>process_string() If this_object() doesn't exist, it defaults to this_player() and receives the backbone uid (returned by master-&gt;get_bb_uid()) as euid. If strict-euids, this uid must not be 0.</p>
<p>Userids and Effective Userids This is probably the most important difference between the modes.</p>
<p>LPMud always had userids (uids) attributing the objects, though they were called 'creator names' in compat mode. Internally, the compat mode uses the 'creator names' as (e)uid.</p>
<p>With the introduction of native/plain mode, additionally 'effective userids' (euids) were introduced to improve security handling (which was only a partial success). The hardcoded handling of euids and uids was quite complex and too mudlib-insensitive, so most of it got moved from the driver into the mudlib with 3.2.1.</p>
<p>In strict-euids mode, only objects with a non-zero euid may load or create new objects.</p>
<p>&mdash; In Detail &mdash;</p>
<p>Userids of the Master The master's (e)uid is determined by a call to master-&gt;get_master_uid().</p>
<p>In strict-euids mode, the result has to be a string, otherwise the driver won't start up at all. If the result is valid it is set as the master's uid and euid.</p>
<p>In !strict-euids mode, the result may be any value: 0 or a string are treated as the uid to set, a non-zero integer leads to the use of the uid set in the default 'global' wizlist entry, and any other value defaults to 0. The euid is either set to the returned string (if any), or to 0.</p>
<p>The master's uid is determined only on startup this way; at runtime the uids of a reloaded master determined as for every object by a call to the appropriate driver hooks.</p>
<p>Userids of New Objects To determine the (e)uids for a new object (loaded or inherited, or cloned), the appropriate driver hook is evaluated (H_LOAD_UIDS, H_CLONE_UIDS) and the result set as (e)uid. The result may be a single value, in which case the euid is set to 0, or an array ({ uid, euid }).</p>
<p>In strict-euids mode, both uid and euid must be 0 or a string, any other value causes the load/clone to fail.</p>
<p>In !strict-euids mode, the uid (however returned) may also be a non-zero integer to use the uid of the global wizlist entry as uid. The euid is then set to either 0 or the second entry of the returned array if it's a string.</p>
<dl class="section see"><dt>See Also</dt><dd><a class="el" href="driver_concepts_uids.html">uids</a>, <a class="el" href="classefun.html#abe35f52e64f6dbd29684c3b780b6a985">efun::move_object()</a> </dd></dl>
</div></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="driver_todo.html">todo</a></li>
    <li class="footer">Generated on Sat Jun 11 2016 14:24:11 for Tsunami by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.6 </li>
  </ul>
</div>
</body>
</html>
