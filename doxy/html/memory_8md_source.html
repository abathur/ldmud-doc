<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.6"/>
<title>LDMud: topics/memory.md Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">LDMud
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.6 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('memory_8md.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">topics/memory.md</div>  </div>
</div><!--header-->
<div class="contents">
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;memory swapping {#driver_topics_memory}</div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;=======================================</div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;@par misleading: This document is out of date.</div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;</div>
<div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;(Collected from the Changelogs of the driver source)</div>
<div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;</div>
<div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;The swapping algorithm has been changed. A test is done <span class="keywordflow">for</span> every <span class="keywordtype">object</span>, comparing to a time stamp. If the <span class="keywordtype">object</span> hasn<span class="stringliteral">&#39;t been touched for a while, it could be subject for swapping. Here comes the new thing: the function @ref driver_hook_clean_up &quot;H_CLEAN_UP&quot; will be called in the object. If the object still remains, the old swapping algorithm will continue. That means that objects that would never be subject to swapping (cloned objects) now have a chance to self-destruct. It also means that rooms that contains no important data can self-destruct. Self-destruction saves more memory than swapping, as swapping only frees the program code, while self-destruction also frees the internal object representation.</span></div>
<div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;<span class="stringliteral"></span></div>
<div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;<span class="stringliteral">The call of @ref driver_hook_clean_up &quot;H_CLEAN_UP&quot; has been modified. There is a constant in `config.h` that defines how long time until clean_up is called in an object. This call is independent of @ref driver_hook_reset &quot;H_RESET&quot; and swapping. It is recommended that the swapping time is something short, like 10 minutes to 30 minutes, while the time to @ref driver_hook_clean_up &quot;clean_up&quot; is longer.</span></div>
<div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;<span class="stringliteral"></span></div>
<div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;<span class="stringliteral">Fixed several bugs in the swap/reset/clean_up logic. Recommended values are that the swap time is short (less than 30 minutes), and that reset time is medium (aprox 60 minutes), and that time to clean_up is long (greater than 1.5h hours). Any feedback of how to best tune these values are welcome. The call of reset will be done once, and not yet again until the object has been touched. This enables reset&#39;</span>ed objects to stay swapped out. If you have a mudlib that has no objects that define @ref driver_hook_clean_up <span class="stringliteral">&quot;clean_up&quot;</span>, then you may better define <span class="keyword">this</span> time as 0, which means never call clean_up (and thus never swap the <span class="keywordtype">object</span> in needlessly). A well implemented usage of clean_up is better than the swap algorithm, as even cloned objects can be cleaned up and a <span class="keyword">self</span> destruction is more efficient than swapping (memory wise).</div>
<div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;</div>
<div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;Changed mechanism of calling @ref driver_hook_clean_up <span class="stringliteral">&quot;H_CLEAN_UP&quot;</span> slightly. Only objects that define the <span class="keyword">function</span> will be called. And, only @ref driver_hook_clean_up <span class="stringliteral">&quot;H_CLEAN_UP&quot;</span> that returns non-zero will be called again. This will minimize calls of @ref driver_hook_clean_up <span class="stringliteral">&quot;H_CLEAN_UP&quot;</span>, <span class="keywordflow">while</span> still costing little to maintain.</div>
<div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;</div>
<div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;@ref driver_hook_clean_up <span class="stringliteral">&quot;H_CLEAN_UP&quot;</span> now gets a flag as argument, which will be non-zero <span class="keywordflow">if</span> the the program of <span class="keyword">this</span> <span class="keywordtype">object</span> is used <span class="keywordflow">for</span> inheritance by other objects.</div>
<div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;</div>
<div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;@see applied::clean_up(), <a class="code" href="classmaster.html#a0cd5e1ddfbffbc3821e10637d05d65b9">master::slow_shut_down</a>(), <a class="code" href="classmaster.html#a5d411079dff87dd764702b33109ed956">master::quota_demon</a>(), <a class="code" href="classmaster.html#a20f6cacaf82203fd9e97687c9909a383">master::low_memory</a>(), <a class="code" href="classefun.html#a67ed52ff313f35d713201c8427a64d05">efun::garbage_collection</a>()</div>
<div class="ttc" id="classmaster_html_a0cd5e1ddfbffbc3821e10637d05d65b9"><div class="ttname"><a href="classmaster.html#a0cd5e1ddfbffbc3821e10637d05d65b9">master.slow_shut_down</a></div><div class="ttdeci">void slow_shut_down(int minutes)</div><div class="ttdoc">Schedule a shutdown for the near future. </div></div>
<div class="ttc" id="classmaster_html_a5d411079dff87dd764702b33109ed956"><div class="ttname"><a href="classmaster.html#a5d411079dff87dd764702b33109ed956">master.quota_demon</a></div><div class="ttdeci">void quota_demon(void)</div><div class="ttdoc">Handle quotas in times of memory shortage. </div></div>
<div class="ttc" id="classefun_html_a67ed52ff313f35d713201c8427a64d05"><div class="ttname"><a href="classefun.html#a67ed52ff313f35d713201c8427a64d05">efun.garbage_collection</a></div><div class="ttdeci">void garbage_collection(string filename, int flag)</div><div class="ttdoc">Tell the parser to initiate a garbage collection after the current execution ended. </div></div>
<div class="ttc" id="classmaster_html_a20f6cacaf82203fd9e97687c9909a383"><div class="ttname"><a href="classmaster.html#a20f6cacaf82203fd9e97687c9909a383">master.low_memory</a></div><div class="ttdeci">void low_memory(int what, int limitvalue, int memory, int reservestate)</div><div class="ttdoc">This efun is called when there is a (potential) low-memory situation. </div></div>
</div><!-- fragment --></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><b>memory.md</b></li>
    <li class="footer">Generated on Thu Mar 9 2017 17:45:23 for LDMud by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.6 </li>
  </ul>
</div>
</body>
</html>
