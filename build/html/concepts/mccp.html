<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>mccp &mdash; LDMud UNRELEASED documentation</title>
    
    <link rel="stylesheet" href="../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     'UNRELEASED',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="top" title="LDMud UNRELEASED documentation" href="../index.html" />
    <link rel="up" title="concepts" href="concepts.html" />
    <link rel="next" title="memory" href="memory.html" />
    <link rel="prev" title="intermud.basic" href="intermud.basic.html" />
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head>
  <body role="document">
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="mccp">
<span id="lpc.mccp"></span><div class="section" id="CONCEPT">
<h2>CONCEPT<a class="headerlink" href="#CONCEPT" title="Permalink to this headline">¶</a></h2>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">mccp:</th><td class="field-body"><span class="first last">The Mud Client Compression Protocol</span></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="DESCRIPTION">
<h2>DESCRIPTION<a class="headerlink" href="#DESCRIPTION" title="Permalink to this headline">¶</a></h2>
<p>Information and code taken from the MCCP Homepage <a class="reference external" href="http://www.randomly.org/projects/MCCP/">http://www.randomly.org/projects/MCCP/</a></p>
<p>MCCP is implemented as a Telnet option [RFC854, RFC855]. The server and client negotiate the use of MCCP as they would any other telnet option. Once agreement has been reached on the use of the option, option subnegotiation is used to determine acceptable compression methods to use, and to indicate the start of a compressed data stream.</p>
<p>If the driver is compiled with MCCP Support there is a define __MCCP__.</p>
<p>The driver currently supports both versions of mccp. If your mud has a H_NOECHO hook you have to find out if the client supports mccp. Without this hook you still have to start neogotiation.</p>
<p>All sub-negotiation is done by the efuns start_mccp_compress() and end_mccp_compress() whether you have this hook or not.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">when the client uses compressions all binary_message calls are executed with flag=3. This is because writing to the socket would disturb zlib stream.</p>
</div>
<p>mccp-efuns:</p>
<blockquote>
<div><ul class="simple">
<li><a class="reference internal" href="../efun/start_mccp_compress.html#lpc.start_mccp_compress" title="start_mccp_compress"><code class="xref lpc lpc-efun docutils literal"><span class="pre">start_mccp_compress(int</span> <span class="pre">telopt)</span></code>(E)</a> (only needed with H_NOECHO)</li>
<li><a class="reference internal" href="../efun/end_mccp_compress.html#lpc.end_mccp_compress" title="end_mccp_compress"><code class="xref lpc lpc-efun docutils literal"><span class="pre">end_mccp_compress(int</span> <span class="pre">telopt)</span></code>(E)</a>   (only needed with H_NOECHO)</li>
<li><a class="reference internal" href="../efun/query_mccp.html#lpc.query_mccp" title="query_mccp"><code class="xref lpc lpc-efun docutils literal"><span class="pre">query_mccp(object</span> <span class="pre">player)</span></code>(E)</a></li>
<li><a class="reference internal" href="../efun/query_mccp_stats.html#lpc.query_mccp_stats" title="query_mccp_stats"><code class="xref lpc lpc-efun docutils literal"><span class="pre">query_mccp_stats(object</span> <span class="pre">player)</span></code>(E)</a></li>
</ul>
</div></blockquote>
<p>Initiating MCCP without H_NOECHO hook:</p>
<div class="highlight-c"><div class="highlight"><pre><span></span><span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="n">query_mccp</span><span class="p">()){</span>
  <span class="n">binary_message</span><span class="p">(({</span> <span class="n">IAC</span><span class="p">,</span> <span class="n">WILL</span><span class="p">,</span> <span class="n">TELOPT_COMPRESS2</span> <span class="p">}),</span><span class="mi">1</span><span class="p">)</span>
  <span class="n">binary_message</span><span class="p">(({</span> <span class="n">IAC</span><span class="p">,</span> <span class="n">WILL</span><span class="p">,</span> <span class="n">TELOPT_COMPRESS</span> <span class="p">}),</span><span class="mi">1</span><span class="p">)</span>
<span class="p">}</span>
</pre></div>
</div>
<p>the driver will parse the clients answers and start compression. (The connection might already be compressed, because although the documentation says clients should not negotiate from themselves, zmud e.g. does.)</p>
<p>You can start and stop compression manually by efuns when you are sure client supports compression :)</p>
<div class="admonition-todo admonition" id="index-0">
<p class="first admonition-title">Todo</p>
<p class="last">something more semantic or at least w/ better presentation than a literal here?</p>
</div>
<p>Initiating MCCP compression with H_NOECHO hook:</p>
<div class="highlight-c"><div class="highlight"><pre><span></span><span class="n">If</span> <span class="n">your</span> <span class="n">mudlib</span> <span class="n">uses</span> <span class="n">the</span> <span class="n">H_NOECHO</span> <span class="n">driver</span><span class="o">-</span><span class="n">hook</span> <span class="n">you</span> <span class="n">decided</span> <span class="n">to</span> <span class="k">do</span>
<span class="n">all</span> <span class="n">the</span> <span class="n">negotiation</span> <span class="n">by</span> <span class="nl">yourself</span><span class="p">:</span>

<span class="n">Server</span> <span class="n">Commands</span>
<span class="n">IAC</span> <span class="n">WILL</span> <span class="n">COMPRESS</span>  <span class="n">indicates</span> <span class="n">the</span> <span class="n">sender</span> <span class="n">supports</span> <span class="n">version</span> <span class="mi">1</span> <span class="n">of</span> <span class="n">the</span>
                   <span class="n">protocol</span><span class="p">,</span> <span class="n">and</span> <span class="n">is</span> <span class="n">willing</span> <span class="n">to</span> <span class="n">compress</span> <span class="n">data</span> <span class="n">it</span> <span class="n">sends</span><span class="p">.</span>

<span class="n">IAC</span> <span class="n">WILL</span> <span class="n">COMPRESS2</span> <span class="n">indicates</span> <span class="n">the</span> <span class="n">sender</span> <span class="n">supports</span> <span class="n">version</span> <span class="mi">2</span><span class="p">,</span> <span class="n">and</span> <span class="n">is</span>
                   <span class="n">willing</span> <span class="n">to</span> <span class="n">compress</span> <span class="n">data</span> <span class="n">it</span> <span class="n">sends</span><span class="p">.</span>

<span class="n">IAC</span> <span class="n">WONT</span> <span class="n">COMPRESS</span>  <span class="n">indicates</span> <span class="n">the</span> <span class="n">sender</span> <span class="n">refuses</span> <span class="n">to</span> <span class="n">compress</span> <span class="n">data</span> <span class="n">using</span>
                   <span class="n">version</span> <span class="mf">1.</span>

<span class="n">IAC</span> <span class="n">WONT</span> <span class="n">COMPRESS2</span> <span class="n">indicates</span> <span class="n">the</span> <span class="n">sender</span> <span class="n">refuses</span> <span class="n">to</span> <span class="n">compress</span> <span class="n">data</span>
                   <span class="n">using</span> <span class="n">version</span> <span class="mf">2.</span>

<span class="n">Client</span> <span class="n">Commands</span>
<span class="n">IAC</span> <span class="n">DO</span> <span class="n">COMPRESS</span>    <span class="n">indicates</span> <span class="n">the</span> <span class="n">sender</span> <span class="n">supports</span> <span class="n">version</span> <span class="mi">1</span> <span class="n">of</span> <span class="n">the</span>
                   <span class="n">protocol</span><span class="p">,</span> <span class="n">and</span> <span class="n">is</span> <span class="n">willing</span> <span class="n">to</span> <span class="n">decompress</span> <span class="n">data</span>
                   <span class="n">received</span><span class="p">.</span>

<span class="n">IAC</span> <span class="n">DO</span> <span class="n">COMPRESS2</span>   <span class="n">indicates</span> <span class="n">the</span> <span class="n">sender</span> <span class="n">supports</span> <span class="n">version</span> <span class="mi">2</span> <span class="n">or</span> <span class="n">above</span><span class="p">,</span>
                   <span class="n">and</span> <span class="n">is</span> <span class="n">willing</span> <span class="n">to</span> <span class="n">decompress</span> <span class="n">data</span> <span class="n">received</span><span class="p">.</span>

<span class="n">IAC</span> <span class="n">DONT</span> <span class="n">COMPRESS</span>  <span class="n">indicates</span> <span class="n">the</span> <span class="n">sender</span> <span class="n">refuses</span> <span class="n">to</span> <span class="n">support</span> <span class="n">version</span> <span class="mf">1.</span>
                   <span class="n">If</span> <span class="n">compression</span> <span class="n">was</span> <span class="n">previously</span> <span class="n">negotiated</span> <span class="n">and</span> <span class="n">is</span>
                   <span class="n">currently</span> <span class="n">being</span> <span class="n">used</span><span class="p">,</span> <span class="n">the</span> <span class="n">server</span> <span class="n">should</span> <span class="n">terminate</span>
                   <span class="n">compression</span><span class="p">.</span>

<span class="n">IAC</span> <span class="n">DONT</span> <span class="n">COMPRESS2</span> <span class="n">indicates</span> <span class="n">the</span> <span class="n">sender</span> <span class="n">refuses</span> <span class="n">to</span> <span class="n">support</span> <span class="n">version</span> <span class="mf">2.</span>
                   <span class="n">If</span> <span class="n">compression</span> <span class="n">was</span> <span class="n">previously</span> <span class="n">negotiated</span> <span class="n">and</span> <span class="n">is</span>
                   <span class="n">currently</span> <span class="n">being</span> <span class="n">used</span><span class="p">,</span> <span class="n">the</span> <span class="n">server</span> <span class="n">should</span> <span class="n">terminate</span>
                   <span class="n">compression</span>

<span class="n">After</span> <span class="n">you</span> <span class="n">found</span> <span class="n">out</span> <span class="n">whether</span> <span class="n">the</span> <span class="n">client</span> <span class="n">supports</span> <span class="n">mccp</span> <span class="n">or</span> <span class="n">not</span> <span class="n">you</span> <span class="n">can</span>
<span class="n">start</span> <span class="n">compression</span> <span class="n">with</span> <span class="n">start_mccp_compress</span><span class="p">(</span><span class="n">TELOPT_COMPRESS2</span><span class="p">)</span> <span class="n">or</span>
<span class="n">start_mccp_compress</span><span class="p">(</span><span class="n">TELOPT_COMPRESS</span><span class="p">).</span> <span class="p">(</span> <span class="n">you</span> <span class="n">could</span> <span class="n">start</span> <span class="n">it</span> <span class="n">without</span>
<span class="n">checking</span> <span class="n">but</span> <span class="n">some</span> <span class="n">players</span> <span class="n">would</span> <span class="nl">protest</span> <span class="p">:)</span> <span class="p">)</span>
</pre></div>
</div>
<div class="section" id="LORE">
<h2>LORE<a class="headerlink" href="#LORE" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li>author: Bastian Hoyer (<a class="reference external" href="mailto:dafire&#37;&#52;&#48;ff&#46;mud&#46;de">dafire<span>&#64;</span>ff<span>&#46;</span>mud<span>&#46;</span>de</a>) (some text taken from project page)</li>
</ul>
</div>
<div class="section" id="HISTORY">
<h2>HISTORY<a class="headerlink" href="#HISTORY" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><strong>introduced</strong> (<em>3.3.447</em>)</li>
<li><strong>backported</strong> (<em>3.2.10</em>)</li>
</ul>
</div>
<div class="section" id="see2also">
<h2>SEE ALSO<a class="headerlink" href="#see2also" title="Permalink to this headline">¶</a></h2>
<p><a class="reference internal" href="../efun/start_mccp_compress.html#lpc.start_mccp_compress" title="start_mccp_compress"><code class="xref lpc lpc-efun docutils literal"><span class="pre">start_mccp_compress()</span></code>(E)</a>, <a class="reference internal" href="../efun/end_mccp_compress.html#lpc.end_mccp_compress" title="end_mccp_compress"><code class="xref lpc lpc-efun docutils literal"><span class="pre">end_mccp_compress()</span></code>(E)</a>, <a class="reference internal" href="../efun/query_mccp.html#lpc.query_mccp" title="query_mccp"><code class="xref lpc lpc-efun docutils literal"><span class="pre">query_mccp()</span></code>(E)</a>, <a class="reference internal" href="../efun/query_mccp_stats.html#lpc.query_mccp_stats" title="query_mccp_stats"><code class="xref lpc lpc-efun docutils literal"><span class="pre">query_mccp_stats()</span></code>(E)</a></p>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
  <h3><a href="../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">mccp</a><ul>
<li><a class="reference internal" href="#CONCEPT">CONCEPT</a></li>
<li><a class="reference internal" href="#DESCRIPTION">DESCRIPTION</a><ul>
<li><a class="reference internal" href="#LORE">LORE</a></li>
<li><a class="reference internal" href="#HISTORY">HISTORY</a></li>
<li><a class="reference internal" href="#see2also">SEE ALSO</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<h3>Navigation</h3>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../applied/applied.html">applied</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="concepts.html">concepts</a></li>
<li class="toctree-l1"><a class="reference internal" href="../driver/driver.html">driver</a></li>
<li class="toctree-l1"><a class="reference internal" href="../efun/efun.html">efun</a></li>
<li class="toctree-l1"><a class="reference internal" href="../hook/hook.html">hook</a></li>
<li class="toctree-l1"><a class="reference internal" href="../internals/internals.html">internals</a></li>
<li class="toctree-l1"><a class="reference internal" href="../master/master.html">master</a></li>
<li class="toctree-l1"><a class="reference internal" href="../obsolete/obsolete.html">obsolete</a></li>
<li class="toctree-l1"><a class="reference internal" href="../LPC/lpc.html">LPC</a></li>
</ul>


        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;good question.
      
      |
      <a href="../_sources/concepts/mccp.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>