<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>efun::terminal_colour() &mdash; LDMud UNRELEASED documentation</title>
    
    <link rel="stylesheet" href="../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     'UNRELEASED',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="top" title="LDMud UNRELEASED documentation" href="../index.html" />
    <link rel="up" title="efun" href="efun.html" />
    <link rel="next" title="efun::test_bit()" href="test_bit.html" />
    <link rel="prev" title="efun::tell_room()" href="tell_room.html" />
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head>
  <body role="document">
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section">
<div class="section" id="SYNOPSIS">
<span id="terminal_colour"></span><h2>SYNOPSIS<a class="headerlink" href="#SYNOPSIS" title="Permalink to this headline">¶</a></h2>
<table class="function" style="border-spacing:0;">
<tr id="lpc.terminal_colour">
<td>
varargs <a class="reference internal" href="../LPC/string.html#lpc.string" title="string">string</a> </td><td>
<code class="descname">terminal_colour</code></td><td><span class="sig-paren">(</span></td><td>
<a class="reference internal" href="../LPC/string.html#lpc.string" title="string">string</a><em>&nbsp;str</em>, </td><td>
null|<a class="reference internal" href="../LPC/mappings.html#lpc.mapping" title="mapping">mapping</a>|<a class="reference internal" href="../LPC/closures.html#lpc.closure" title="closure">closure</a><em>&nbsp;map</em>, </td><td>
<a class="reference internal" href="../LPC/int.html#lpc.int" title="int">int</a><em>&nbsp;wrap</em>, </td><td>
<a class="reference internal" href="../LPC/int.html#lpc.int" title="int">int</a><em>&nbsp;indent</em></td><td colspan="1000" style="border:0;padding:0;margin:0;text-align:right;"><span class="sig-paren">)</span></td><a class="headerlink" href="#lpc.terminal_colour" title="Permalink to this definition">¶</a></tr>
</table></div>
<div class="section" id="DESCRIPTION">
<h2>DESCRIPTION<a class="headerlink" href="#DESCRIPTION" title="Permalink to this headline">¶</a></h2>
</div>
</div>
<p>If &lt;map&gt; is given as a non-0 value, this efun expands all
colour-defines of the form &#8220;%^KEY%^&#8221; (see below for details) from the
input-string and replaces them by the apropriate values found
for the color-key specified by &lt;map&gt;.</p>
<p>If &lt;map&gt; is a mapping, the entries queries have the
format &#8220;KEY&#8221; : &#8220;value&#8221;, non-string contents are ignored with one
exception: if the mapping contains an entry 0:value, it is used
for all otherwise unrecognized keys. The value in this case can be
a string, or a closure. If it is a closure, it takes the key as
argument and has to return the replacement string.</p>
<p>If &lt;map&gt; is given as a closure, it is called with the KEYs to
replace, and has to return the replacement string.</p>
<p>The special keys &#8220;%^%^&#8221; and &#8220;%%^^&#8221; are always replaced with the
literal &#8220;%^&#8221;.</p>
<p>The parameters &lt;wrap&gt; and &lt;indent&gt; are both optional. If only &lt;wrap&gt;
is given, &lt;str&gt; will be linewrapped at &lt;wrap&gt; columns. If &lt;indent&gt;
is also given, all wrapped lines will also be indented by &lt;indent&gt;
blanks.</p>
<p>The wrapper itself ignores the length of the color macros and that
what they contain, it wraps the string based on the length of the
other chars inside. Therefore it is color-aware.</p>
<p>If &lt;map&gt; is given as 0, the efun does no colour-define detection
and replacement at all, but still does linewrapping and indentation
if requested. This way terminal_colour() doubles as a simple
line wrapping function, duplicating the functionality also
provided by sprintf(&#8220;%-=s&#8221;).</p>
<p>KEY RECOGNITION STRATEGY
As mentioned above, the special keys &#8220;%^%^&#8221; and &#8220;%%^^&#8221; are always
replaced with the literal &#8220;%^&#8221; and play no role in the following
considerations.</p>
<p>The input string is supposed to follow this syntax:</p>
<blockquote>
<div>text { &#8216;%^&#8217; colorkey &#8216;%^&#8217; text } [ &#8216;%^&#8217; colorkey ]</div></blockquote>
<p>or in words: the efun splits up the string at every &#8216;%^&#8217; it finds
and then treats every second substring as color key.</p>
<p>Note that this is different from the way MudOS treats the
input string. MudOS uses this syntax:</p>
<blockquote>
<div>key_or_text { &#8216;%^&#8217; key_or_text }</div></blockquote>
<p>Or in words: the MudOS efun splits the string at every &#8216;%^&#8217; and
then tries to treat every substring as color key. One can achieve
the MudOS behaviour with this LPC function:</p>
<blockquote>
<div><dl class="docutils">
<dt>string mudos_terminal_colour(string str, mapping ext, int w, int i) {</dt>
<dd><dl class="first last docutils">
<dt>return terminal_colour(&#8220;%^&#8221;+implode(explode(str, &#8220;%^&#8221;)-({&#8220;&#8221;})</dt>
<dd><blockquote class="first">
<div>,&#8221;%^%^&#8221;)</div></blockquote>
<p class="last">, ext, w, i);</p>
</dd>
</dl>
</dd>
</dl>
<p>}</p>
</div></blockquote>
<p>EXAMPLES
mapping trans;
string str;</p>
<p>trans = ([ &#8220;GREEN&#8221; : &#8220;ansi-green&#8221;, &#8220;RED&#8221; : &#8220;&#8221;, &#8220;BLUE&#8221; : 1 ]);</p>
<p>str = terminal_colour( &#8220;%^GREEN%^ and %^RED%^ and %^BLUE%^&#8221;, trans );</p>
<p>This will result in str == &#8220;ansi-green and  and BLUE&#8221;</p>
<p>%^GREEN%^ is expanded to ansi-green because trans defines that,
%^RED%^ is stripped because trans defines that as &#8220;&#8221; and
%^BLUE%^ gets the %^&#8217;s removed because the contents of trans are
not valid (i.e. no string). The same would happen to %^DEFINES%^
where the key is not found inside the trans mapping.</p>
<p>Caveat: to replace adjacent keys, use the efun like this:</p>
<blockquote>
<div>str = terminal_colour( &#8220;%^GREEN%^%^RED%^&#8221;, trans );</div></blockquote>
<p>A command like:</p>
<blockquote>
<div>str = terminal_colour( &#8220;%^GREEN%^RED%^&#8221;, trans );</div></blockquote>
<p>will return the logical but sometimes unexpected &#8220;ansi-greenRED&#8221;.</p>
<p>Some words about wrapping:</p>
<p>a string wrapped without indent would look like this:</p>
<blockquote>
<div>&#8220;this is the first linenand this is the second line&#8221;</div></blockquote>
<p>a string wrapped with indent 3 would look like:</p>
<blockquote>
<div>&#8220;this is the first linen   and this is the indented second one&#8221;</div></blockquote>
<p>Efun idea and initial implementation taken from MudOS; the key
recognition strategy (including pure wrapping mode) was straightened
out in LDMud 3.2.8.
LDMud 3.2.9/3.3.58 added the use of closures to specify the colour
mappings.
LDMud 3.2.9/3.3.102 officialized the &#8220;%%^^&#8221; replacement pattern for
better MudOS compatibility.</p>
<blockquote>
<div><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">See Also:</th><td class="field-body"><a class="reference internal" href="sprintf.html#lpc.sprintf" title="sprintf"><code class="xref lpc lpc-efun docutils literal"><span class="pre">sprintf()</span></code>(E)</a></td>
</tr>
</tbody>
</table>
</div></blockquote>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
  <h3><a href="../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">efun::terminal_colour()</a><ul>
<li><a class="reference internal" href="#SYNOPSIS">SYNOPSIS</a></li>
<li><a class="reference internal" href="#DESCRIPTION">DESCRIPTION</a></li>
</ul>
</li>
</ul>
<h3>Navigation</h3>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../applied/applied.html">applied</a></li>
<li class="toctree-l1"><a class="reference internal" href="../concepts/concepts.html">concepts</a></li>
<li class="toctree-l1"><a class="reference internal" href="../driver/driver.html">driver</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="efun.html">efun</a></li>
<li class="toctree-l1"><a class="reference internal" href="../hook/hook.html">hook</a></li>
<li class="toctree-l1"><a class="reference internal" href="../internals/internals.html">internals</a></li>
<li class="toctree-l1"><a class="reference internal" href="../master/master.html">master</a></li>
<li class="toctree-l1"><a class="reference internal" href="../obsolete/obsolete.html">obsolete</a></li>
<li class="toctree-l1"><a class="reference internal" href="../LPC/lpc.html">LPC</a></li>
</ul>


        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;good question.
      
      |
      <a href="../_sources/efun/terminal_colour.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>