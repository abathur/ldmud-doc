<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Language &mdash; LDMud UNRELEASED documentation</title>
    
    <link rel="stylesheet" href="../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     'UNRELEASED',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="top" title="LDMud UNRELEASED documentation" href="../index.html" />
   
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9">

  </head>
  <body role="document">  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <blockquote>
<div><p>The LPMud gamedriver is by nature the result of the cooperative work
of multiple programmers, often separated by large oceans and years
of time. In order to keep the appearance of the driver source consistent
(and with that maintainable), the following guidelines should be followed
for all code contributions.</p>
<p>For a quick start in how good driver source should look like, take
a look at comm.{c,h}, object.{c,h} and mapping.{c.h}.</p>
<p>The guidelines have a strong emphasis on code layout and commenting,
stemming from the fact that proper layout and comments gave the
incentive for LDMud in the first place. Right now, 50% of all lines
are comments, and that has been proven to be a Good Thing.</p>
<p>Any reader of the &#8220;real programmers don&#8217;t write comments&#8221;-school
of thought is asked to take his or her incompetence elsewhere.</p>
</div></blockquote>
<div class="section" id="language">
<h1>Language<a class="headerlink" href="#language" title="Permalink to this headline">¶</a></h1>
<blockquote>
<div><p>The language is ISO Standard C (also known as &#8216;C89&#8217; or &#8216;ANSI C&#8217;).
Common compiler extensions or features from the new C99 standard are
permitted if their addition is transparent for other C89 compilers.
For example: the &#8216;inline&#8217; keyword permitted through the use of the
INLINE macro; so are the Metrowerks-pragmas and GNU-attributes. Not
permitted are GNU&#8217;s local functions.</p>
<p>System/Platform specifics are to be detected by the configure script
and provided with transparent implementations in port.{c,h} (or for
module-specific dependencies in the respective modules).</p>
<p>Adherence to the Standard has the following implications:</p>
<blockquote>
<div><ul>
<li><p class="first">All functions must be fully prototyped.</p>
</li>
<li><p class="first">Standard types like size_t, ssize_t or ptrdiff_t are to be used
whereever possible.</p>
</li>
<li><dl class="first docutils">
<dt>Unixisms like</dt>
<dd><dl class="first docutils">
<dt>{</dt>
<dd><p class="first last">a = malloc(20);
b = malloc(20);
c = b-a;</p>
</dd>
</dl>
<p class="last">}</p>
</dd>
</dl>
<p>are not legal and shouldn&#8217;t be used.</p>
</li>
<li><p class="first">Don&#8217;t make assumptions about the size of the base types (e.g.
a char might have more than 8 bits). If such an assumption
is unavoidable, comment it clearly and if possible add a test
to raise a compile or runtime error if the assumption is not met.</p>
</li>
</ul>
</div></blockquote>
</div></blockquote>
</div>
<div class="section" id="style">
<h1>Style<a class="headerlink" href="#style" title="Permalink to this headline">¶</a></h1>
<blockquote>
<div><p>All modules (.c-files) have to have their interface in an accompanying
.h-file. The header file must be guarded against repeated inclusion
with the normal</p>
<blockquote>
<div><p>#ifndef HEADERNAME_H
#define HEADERNAME_H 1</p>
<blockquote>
<div>...</div></blockquote>
<p>#endif /* HEADERNAME_H <a href="#id1"><span class="problematic" id="id2">*</span></a>/</p>
</div></blockquote>
<p>construct. To use a module, its headerfile must be included - no random
&#8216;extern&#8217; declarations.</p>
<p>Every module must include &#8220;driver.h&#8221; which in turn includes the
portability headers and provides common defines.</p>
<p>Use the driver-provided types and macros like Bool or p_int.</p>
<p>Code should be written defensively and readable. This is not the IOCCC.</p>
<p>No magic numbers - use #defines to give them names.</p>
<p>Add sanity checks where useful. If the checks are costly, enclose
them in a #ifdef DEBUG...#endif bracket.</p>
<p>Comment questionable code or opportunities for possible extensions with a
&#8216;TODO: ...&#8217; comment. For multiline comments, use &#8216;TODO::&#8217; on the second
and following lines (this makes reading a grep easier).</p>
<p>Comment temporary debug code with a &#8216;DEBUG:&#8217; comment. Similar, debug
output should always begin with &#8216;DEBUG:&#8217;.</p>
<p>Variable identifiers should start with a lowercase letter, function
identifiers may start with upper or lowercase, constant identifiers
should start with an uppercase letter. Macro identifiers should be
all UPPERCASE, other identifiers may be under_scored or SkudlyCaps.
Hungarian notation is accepted only in a very light form: pFoo for
pointers, ppFoo for pointer to pointers, iFoo for integer types,
sFoo for string pointers, aFoo for complex types - you get the
idea. But no alpzsFoo and friends.</p>
<p>f_xxx() function names are reserved for efun implementations.
typedef&#8217;d typenames should end in _t (e.g. &#8216;mapping_t&#8217;), struct
names should end in _s (e.g. &#8216;struct instrs_s&#8217;).</p>
<p>Indentation is 4 spaces per level. No tab characters anywhere!</p>
<p>The indentation style is a variant of the &#8216;Allman style&#8217;:</p>
<blockquote>
<div><p>if (foo)
{</p>
<blockquote>
<div>...body...</div></blockquote>
<p>} /* if (foo) <a href="#id3"><span class="problematic" id="id4">*</span></a>/</p>
</div></blockquote>
<p>Note the comment at the closing brace!</p>
<p>One line bodies may be written as</p>
<blockquote>
<div>if (foo) body;</div></blockquote>
<p>or</p>
<blockquote>
<div><dl class="docutils">
<dt>if (foo)</dt>
<dd>body;</dd>
</dl>
</div></blockquote>
<p>_if_ it improves the readability.</p>
<p>Similar, the typical layout of a function is:</p>
<blockquote>
<div><p>static int
function_name ( arg1 , arg2)</p>
<dl class="docutils">
<dt>/* Twiddle &lt;arg1&gt; with &lt;arg2&gt; and return the result.</dt>
<dd><a href="#id5"><span class="problematic" id="id6">*</span></a>/</dd>
</dl>
<dl class="docutils">
<dt>{</dt>
<dd></dd>
</dl>
<p>} /* function_name() <a href="#id7"><span class="problematic" id="id8">*</span></a>/</p>
</div></blockquote>
<p>If an expression (argument list, ...) extends over several, the first
literal element on a line should be an operator or syntactical marker:</p>
<blockquote>
<div><dl class="docutils">
<dt>if (condition1</dt>
<dd><dl class="first last docutils">
<dt>&amp;&amp; (   condition2</dt>
<dd><blockquote class="first">
<div>|| condition3)</div></blockquote>
<p class="last">)</p>
</dd>
</dl>
</dd>
<dt>printf( &#8221;...&#8221;</dt>
<dd>, arg1, arg2, arg3
);</dd>
</dl>
</div></blockquote>
<p>Be generous with whitespace - both horizontal and vertical.</p>
<dl class="docutils">
<dt>[ The reasoning behind this style is to use the language elements</dt>
<dd>to create strong visual structures for the eyes to follow. By doing so,
the structure of the program becomes obvious without much
conscious thought.</dd>
</dl>
<p>]</p>
</div></blockquote>
</div>
<div class="section" id="commenting">
<h1>Commenting<a class="headerlink" href="#commenting" title="Permalink to this headline">¶</a></h1>
<blockquote>
<div><p>The comments also follow the idea of giving strong visual clues of
how the program is structured.</p>
<p>Horizontal lines should be created as</p>
<blockquote>
<div>/<em>&#8212;&#8212;...&#8212;&#8212;-</em>/
/<em>======...=======</em>/
/* - - -... - - - <a href="#id9"><span class="problematic" id="id10">*</span></a>/</div></blockquote>
<p>The &#8216;&#8212;&#8217; line is the normal separator between the components of a
source file (includes, variable declarations, macro declarations,
the separate functions). The &#8216;===&#8217; line can be used to separate
larger sections of a source file (e.g. the lowlevel routines from
the efun implementations). &#8216;- -&#8216; lines, which usally span less than
the whole line, can be used to subdivide large functions (though then
it&#8217;s often better to split the function into several small ones).</p>
<p>A &#8216;<a href="#id11"><span class="problematic" id="id12">**</span></a><a href="#id13"><span class="problematic" id="id14">*</span></a>&#8216; line is reserved for the end of every source file.</p>
<p>A &#8216;/* &#8212; Subsection &#8212; <a href="#id15"><span class="problematic" id="id16">*</span></a>/&#8217; is also good to separate subsections.</p>
<p>Vertical lines are to be constructed as</p>
<blockquote>
<div><dl class="docutils">
<dt>/*</dt>
<dd><ul class="first simple">
<li></li>
</ul>
<p class="last"><a href="#id17"><span class="problematic" id="id18">*</span></a>/</p>
</dd>
</dl>
</div></blockquote>
<p>No box comments.</p>
<p>Every function must have a head comment explaining the meaning
of the arguments, what the function does, and the possible results.
For efun implementations, this comment should be identical to the
man page.</p>
<p>Within a function, every variable should be commented as</p>
<blockquote>
<div><p>int foo;  /* short comment <a href="#id19"><span class="problematic" id="id20">*</span></a>/
int bar;</p>
<blockquote>
<div><dl class="docutils">
<dt>/* long comment which doesn&#8217;t fit on one line.</dt>
<dd><a href="#id21"><span class="problematic" id="id22">*</span></a>/</dd>
</dl>
</div></blockquote>
</div></blockquote>
<p>The major steps in a function should be preceeded by a comment
explaining them. Also, wherever a critical design decision has
been made, a comment should line out the whats and whys:</p>
<blockquote>
<div><dl class="docutils">
<dt>/* Duplicate the stored arguments for the function call.</dt>
<dd><ul class="first simple">
<li>(It&#8217;s tempting to use the stored arguments directly</li>
<li>in the last pass; however it&#8217;s not guaranteed that</li>
<li>the last pass actually comes this far.)</li>
</ul>
<p class="last"><a href="#id23"><span class="problematic" id="id24">*</span></a>/</p>
</dd>
</dl>
</div></blockquote>
<p>A typical file layout, commentwise, looks like this:</p>
<blockquote>
<div><dl class="docutils">
<dt>/<a href="#id25"><span class="problematic" id="id26">*</span></a>&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;</dt>
<dd><ul class="first simple">
<li>Gamedriver Bouncing module.</li>
<li></li>
<li>&lt;reserved for future copyright notice&gt;</li>
</ul>
<p class="last"><a href="#id27"><span class="problematic" id="id28">*</span></a>&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;
* &#8216;Big picture&#8217; description of the module and its
* relation to the other gamedriver parts.
*
* Tricky design discussions also belong in here.
<a href="#id29"><span class="problematic" id="id30">*</span></a>&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;
<a href="#id31"><span class="problematic" id="id32">*</span></a>/</p>
</dd>
</dl>
<p>#include &#8220;driver.h&#8221;
#include &#8220;typedefs.h&#8221;</p>
<p>#include &lt;stdlib.h&gt;</p>
<p>#include &#8220;bounce.h&#8221;
#include &#8220;backend.h&#8221;</p>
<p>/<em>&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8211;</em>/</p>
<p>/* &#8212; User information &#8212; <a href="#id33"><span class="problematic" id="id34">*</span></a>/
interactive_t <a href="#id35"><span class="problematic" id="id36">*</span></a>all_bouncers[MAX_PLAYERS];</p>
<p>/* &#8212;  Statistics &#8212; <a href="#id37"><span class="problematic" id="id38">*</span></a>/</p>
<p>p_int number_of_calls;</p>
<p>/<em>&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8211;</em>/
void
add_bouncer (interactive_t <a href="#id39"><span class="problematic" id="id40">*</span></a>bouncer)</p>
<dl class="docutils">
<dt>/* This function adds &lt;bouncer&gt; to the all_bouncers[].</dt>
<dd><a href="#id41"><span class="problematic" id="id42">*</span></a>/</dd>
</dl>
<dl class="docutils">
<dt>{</dt>
<dd>int i;  /* search index <a href="#id43"><span class="problematic" id="id44">*</span></a>/</dd>
</dl>
<p>} /* add_bouncer() <a href="#id45"><span class="problematic" id="id46">*</span></a>/</p>
<p>/<strong>******************************************************</strong>/</p>
</div></blockquote>
</div></blockquote>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
  <h3><a href="../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Language</a></li>
<li><a class="reference internal" href="#style">Style</a></li>
<li><a class="reference internal" href="#commenting">Commenting</a></li>
</ul>
<h3>Navigation</h3>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../hook/hook.html">hooks</a></li>
</ul>


        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;good question.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 1.3.1</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.6</a>
      
      |
      <a href="../_sources/internals/codestyle.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>